<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Web scraping, interactive graphics, Shiny Apps, package building, and more | Lancaster University MATH550/SCC.461 R Programming</title>
  <meta name="description" content="5 Web scraping, interactive graphics, Shiny Apps, package building, and more | Lancaster University MATH550/SCC.461 R Programming" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Web scraping, interactive graphics, Shiny Apps, package building, and more | Lancaster University MATH550/SCC.461 R Programming" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Web scraping, interactive graphics, Shiny Apps, package building, and more | Lancaster University MATH550/SCC.461 R Programming" />
  
  
  

<meta name="author" content="Lecturer: Dr Clement Lee" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="string.html"/>
<link rel="next" href="further-reading.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li><a href="introduction-to-r.html#introduction-to-r"><strong>0</strong> Introduction to R</a><ul>
<li class="chapter" data-level="0.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>0.1</b> Background</a></li>
<li class="chapter" data-level="0.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-your-work"><i class="fa fa-check"></i><b>0.2</b> Saving your work</a></li>
<li class="chapter" data-level="0.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started"><i class="fa fa-check"></i><b>0.3</b> Getting started</a></li>
<li class="chapter" data-level="0.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#s:0help"><i class="fa fa-check"></i><b>0.4</b> Getting Help</a></li>
<li class="chapter" data-level="0.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-scripts"><i class="fa fa-check"></i><b>0.5</b> R scripts</a></li>
<li class="chapter" data-level="0.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>0.6</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="read-plot.html"><a href="read-plot.html"><i class="fa fa-check"></i><b>1</b> Data manipulation and plotting in R</a><ul>
<li class="chapter" data-level="1.1" data-path="read-plot.html"><a href="read-plot.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="read-plot.html"><a href="read-plot.html#working-with-data-in-r"><i class="fa fa-check"></i><b>1.2</b> Working with data in R</a></li>
<li class="chapter" data-level="1.3" data-path="read-plot.html"><a href="read-plot.html#data-types"><i class="fa fa-check"></i><b>1.3</b> Data Types</a></li>
<li class="chapter" data-level="1.4" data-path="read-plot.html"><a href="read-plot.html#logical-comparisons-and-boolean-operations"><i class="fa fa-check"></i><b>1.4</b> Logical comparisons and Boolean operations</a></li>
<li class="chapter" data-level="1.5" data-path="read-plot.html"><a href="read-plot.html#plots"><i class="fa fa-check"></i><b>1.5</b> Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="loops-sim.html"><a href="loops-sim.html"><i class="fa fa-check"></i><b>2</b> Loops, Conditional Statements, and Simulation</a><ul>
<li class="chapter" data-level="2.1" data-path="loops-sim.html"><a href="loops-sim.html#before-you-start"><i class="fa fa-check"></i><b>2.1</b> Before you start</a></li>
<li class="chapter" data-level="2.2" data-path="loops-sim.html"><a href="loops-sim.html#loops"><i class="fa fa-check"></i><b>2.2</b> Loops</a></li>
<li class="chapter" data-level="2.3" data-path="loops-sim.html"><a href="loops-sim.html#conditional-statements"><i class="fa fa-check"></i><b>2.3</b> Conditional statements</a></li>
<li class="chapter" data-level="2.4" data-path="loops-sim.html"><a href="loops-sim.html#probability-and-simulation"><i class="fa fa-check"></i><b>2.4</b> Probability and Simulation</a></li>
<li class="chapter" data-level="2.5" data-path="loops-sim.html"><a href="loops-sim.html#combining-loops-and-simulation"><i class="fa fa-check"></i><b>2.5</b> Combining Loops and Simulation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time.html"><a href="time.html"><i class="fa fa-check"></i><b>3</b> Time manipulation</a><ul>
<li class="chapter" data-level="3.1" data-path="time.html"><a href="time.html#from-last-week"><i class="fa fa-check"></i><b>3.1</b> From last week</a></li>
<li class="chapter" data-level="3.2" data-path="time.html"><a href="time.html#dates-and-timestamps-in-r"><i class="fa fa-check"></i><b>3.2</b> Dates and timestamps in R</a></li>
<li class="chapter" data-level="3.3" data-path="time.html"><a href="time.html#summarising-data-over-time"><i class="fa fa-check"></i><b>3.3</b> Summarising data over time</a></li>
<li class="chapter" data-level="3.4" data-path="time.html"><a href="time.html#a-timestamp-split-over-several-columns"><i class="fa fa-check"></i><b>3.4</b> A timestamp split over several columns</a></li>
<li class="chapter" data-level="3.5" data-path="time.html"><a href="time.html#time-zones"><i class="fa fa-check"></i><b>3.5</b> Time zones</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="string.html"><a href="string.html"><i class="fa fa-check"></i><b>4</b> String processing</a><ul>
<li class="chapter" data-level="4.1" data-path="string.html"><a href="string.html#preamble"><i class="fa fa-check"></i><b>4.1</b> Preamble</a></li>
<li class="chapter" data-level="4.2" data-path="string.html"><a href="string.html#introducing-regular-expressions"><i class="fa fa-check"></i><b>4.2</b> Introducing regular expressions</a></li>
<li class="chapter" data-level="4.3" data-path="string.html"><a href="string.html#working-with-strings-and-regular-expressions"><i class="fa fa-check"></i><b>4.3</b> Working with strings and regular expressions</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exercises"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="web-app.html"><a href="web-app.html"><i class="fa fa-check"></i><b>5</b> Web scraping, interactive graphics, Shiny Apps, package building, and more</a><ul>
<li class="chapter" data-level="5.1" data-path="web-app.html"><a href="web-app.html#packages"><i class="fa fa-check"></i><b>5.1</b> Packages</a></li>
<li class="chapter" data-level="5.2" data-path="web-app.html"><a href="web-app.html#collecting-data"><i class="fa fa-check"></i><b>5.2</b> Collecting data</a></li>
<li class="chapter" data-level="5.3" data-path="web-app.html"><a href="web-app.html#alternative-graphics"><i class="fa fa-check"></i><b>5.3</b> Alternative graphics</a></li>
<li class="chapter" data-level="5.4" data-path="web-app.html"><a href="web-app.html#shiny-web-applications"><i class="fa fa-check"></i><b>5.4</b> Shiny Web Applications</a></li>
<li class="chapter" data-level="5.5" data-path="web-app.html"><a href="web-app.html#rmarkdown-html-notebooks-and-ipythonjupyter-notebooks"><i class="fa fa-check"></i><b>5.5</b> Rmarkdown HTML notebooks and Ipython/Jupyter notebooks</a></li>
<li class="chapter" data-level="5.6" data-path="web-app.html"><a href="web-app.html#exercise-housing-in-new-york-city"><i class="fa fa-check"></i><b>5.6</b> Exercise: Housing in New York City</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i>Further reading</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lancaster University MATH550/SCC.461 R Programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="web-app" class="section level1">
<h1><span class="header-section-number">5</span> Web scraping, interactive graphics, Shiny Apps, package building, and more</h1>
<div id="packages" class="section level2">
<h2><span class="header-section-number">5.1</span> Packages</h2>
<ul>
<li><p>Install the new packages <code>rvest</code> and <code>ggvis</code>. It will also be worth installing <code>readr</code> and <code>purrr</code>.</p></li>
<li><p>Load in the new packages and <code>ggplot2</code>:</p></li>
</ul>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb523-2" title="2"><span class="kw">library</span>(ggvis)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggvis&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     resolution</code></pre>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" title="1"><span class="kw">library</span>(rvest)</a></code></pre></div>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
</div>
<div id="collecting-data" class="section level2">
<h2><span class="header-section-number">5.2</span> Collecting data</h2>
<p>So far the data we’ve used in the labs has been provided for you. More importantly, it’s been given to you in a nice format (e.g. no missing values). In practice you’ll find that most data are messy and that analysing real data requires you to spend time cleaning and manipulating the data into a useable form before you can do your analysis.</p>
<p>One of the best sources of data is the internet. There are now over a billion websites containing data on almost anything you can think of (e.g. income, world poverty, property values, film releases, etc.).</p>
<div id="simple-scraping" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Simple scraping</h3>
<p>In the first lab we looked at a dataset containing information about planets in our solar system. In that exercise we input that data manually. However, we can obtain these data by <em>scraping</em> the data directly from the web.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></p>
<p>The <code>rvest</code> package from Hadley Wickham will allow us to read the data directly from the website. So let’s try it out. Start by loading the package if you haven’t already.</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb531-1" title="1"><span class="kw">library</span>(rvest)</a></code></pre></div>
<p>Once we’ve found a good website containing the data we want, we can scrape the data from the website and store it in a <code>data.frame</code> object</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" title="1">html &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://nssdc.gsfc.nasa.gov/planetary/factsheet/&quot;</span>) </a>
<a class="sourceLine" id="cb532-2" title="2">html_data &lt;-<span class="st"> </span><span class="kw">html_node</span>(html, <span class="st">&quot;table&quot;</span>) <span class="co"># extract parts of HTML text</span></a>
<a class="sourceLine" id="cb532-3" title="3">planet_data &lt;-<span class="st"> </span><span class="kw">html_table</span>(html_data, <span class="dt">header=</span><span class="ot">TRUE</span>) <span class="co"># display table</span></a>
<a class="sourceLine" id="cb532-4" title="4"><span class="kw">head</span>(planet_data)</a></code></pre></div>
<pre><code>##                           MERCURY   VENUS  EARTH  MOON  MARS JUPITER  SATURN
## 1           Mass (1024kg)   0.330    4.87   5.97 0.073 0.642    1898     568
## 2           Diameter (km)    4879  12,104 12,756  3475  6792 142,984 120,536
## 3         Density (kg/m3)    5427    5243   5514  3340  3933    1326     687
## 4          Gravity (m/s2)     3.7     8.9    9.8   1.6   3.7    23.1     9.0
## 5  Escape Velocity (km/s)     4.3    10.4   11.2   2.4   5.0    59.5    35.5
## 6 Rotation Period (hours)  1407.6 -5832.5   23.9 655.7  24.6     9.9    10.7
##   URANUS NEPTUNE  PLUTO
## 1   86.8     102 0.0146
## 2 51,118  49,528   2370
## 3   1271    1638   2095
## 4    8.7    11.0    0.7
## 5   21.3    23.5    1.3
## 6  -17.2    16.1 -153.3</code></pre>
<p>Essentially we’re going to be working with four main functions:</p>
<ul>
<li><code>read_html()</code> - used to set the webpage address</li>
<li><code>html_node()</code>/<code>html_nodes()</code> - select which parts of the website you want to scrape</li>
<li><code>html_table()</code> - convert an HTML table into a <code>data.frame</code> object</li>
<li><code>html_text()</code> - extract HTML text.</li>
</ul>
<p>Used correctly, these functions will allow you to scrape data from alot of websites. However, as you can imagine, the more complex the design of the website, the harder it will be to identify what you’re looking for.</p>
<p>You may find the <a href="https://selectorgadget.com" class="uri">https://selectorgadget.com</a> tool particularly useful. This tool can be added as an extension to Google Chrome.<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a> When activated you can simply hover your mouse over the section of the website you want to scrape and the selectorgadget tool will tell you what the xpath/CSS link is.</p>
<p>Piping is also helpful when running web scraping code. Piping allows you to direct the output from one function to another and then another and then another, etc. by using the <code>\%&gt;\%</code> operator from the <code>dplyr</code> package. As an example, here in an alternative way of implementing the above:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" title="1">planet_data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb534-2" title="2"><span class="st">  </span><span class="kw">read_html</span>(<span class="st">&quot;http://nssdc.gsfc.nasa.gov/planetary/factsheet/&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb534-3" title="3"><span class="st">    </span><span class="kw">html_node</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb534-4" title="4"><span class="st">    </span><span class="kw">html_table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>You’ll notice by comparing the two implementations, that <code>function(a, b)</code> is equivalent to <code>a %&gt;% function(b)</code>. We are plugging our variable into the first argument of the function. If instead we want <code>function(b, a)</code>, then we’ll need to use the form <code>a %&gt;% function(b,.)</code>.</p>
</div>
<div id="exercise" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Exercise</h3>
<p>The planets dataset contains many unwanted characters (e.g. <code>*</code>, commas, words). Use regular expressions and string processing operations, to remove these to create a clean dataset.</p>
</div>
<div id="google-scholar" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Google Scholar</h3>
<p>Google scholar is a helpful resource for finding academic works. In addition to finding journal articles, you can also find profiles of researchers and see what they work on, the papers they publish, how influential they are, and who they work with.</p>
<p>Let’s consider the Google Scholar page of Peter Diggle, Lancaster University Distiguished University Professor of Statistics.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb535-1" title="1">page &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb535-2" title="2"><span class="kw">read_html</span>(<span class="st">&quot;https://scholar.google.com/citations?user=GcTKrPIAAAAJ&amp;hl=en&quot;</span>)</a></code></pre></div>
<p>On the Google Scholar page there are several tables. There is a summary of the researcher’s output (top right). The main table contains the details of each of the researcher’s papers. Let’s scrape these two tables (remember the <code>.</code> indicates the contents from the pipe so far).</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" title="1">overview &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-2" title="2">		<span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-3" title="3">		.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-4" title="4">		<span class="kw">html_table</span>()</a>
<a class="sourceLine" id="cb536-5" title="5">            </a>
<a class="sourceLine" id="cb536-6" title="6">citations &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-7" title="7">		<span class="kw">html_nodes</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-8" title="8">		.[[<span class="dv">2</span>]] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-9" title="9">		<span class="kw">html_table</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-10" title="10">		.[<span class="op">-</span><span class="dv">1</span>,<span class="dv">2</span>] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb536-11" title="11">		readr<span class="op">::</span><span class="kw">parse_number</span>()</a></code></pre></div>
<ul>
<li>The first operation is straightforward. We’re simply scraping the first list element (i.e. <code>[[1]]</code>), which is a table from the webpage.</li>
<li>The second line is a little trickier with two additional operations. Firstly, we’re using <code>[-1,2]</code> to remove the first row of the table and select the second column, just the citations.</li>
</ul>
<div class="figure"><span id="fig:unnamed-chunk-225"></span>
<img src="week5/citations.png" alt="The citations of Prof. Diggle's papers" width="\linewidth" />
<p class="caption">
Figure 5.1: The citations of Prof. Diggle’s papers
</p>
</div>
<p>You’ll often find in practice, especially when working with web scraping, that data isn’t always presented in the most convenient way.</p>
<ul>
<li>The last operation, <code>readr::parse_number()</code>, is simply stripping everything out that isn’t numeric.<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a></li>
</ul>
<p>We have obtained some of the information on the webpage.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb537-1" title="1"><span class="kw">head</span>(overview)</a></code></pre></div>
<pre><code>##               All Since 2015
## 1 Citations 49623      16473
## 2   h-index    86         53
## 3 i10-index   270        199</code></pre>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb539-1" title="1"><span class="kw">head</span>(citations)</a></code></pre></div>
<pre><code>## [1] 11806  5286  3389  1391  1379  1251</code></pre>
<p>Researchers almost never publish alone and will work with numerous collaborators, often across various disciplines. Prof. Diggle is no exception, let’s have a look at some of his co-authors. Remember that the selectorgadget Chrome extension can help you find the name of the CSS tag you need to provide to <code>html_nodes()</code>. Another way is to press <em>Ctrl+Shift+I</em> in Chrome and view the HTML source code. Remember also that websites are frequently updated and so the next time you run this code it will fail if Google have changed the Google Scholar HTML code.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb541-1" title="1">Coauthors =<span class="st"> </span>page <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb541-2" title="2"><span class="st">     </span><span class="kw">html_nodes</span>(<span class="dt">css=</span><span class="st">&quot;.gsc_rsb_a_desc a&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb541-3" title="3"><span class="st">     </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb541-4" title="4">Coauthors =<span class="st"> </span><span class="kw">as.data.frame</span>(Coauthors)</a>
<a class="sourceLine" id="cb541-5" title="5"><span class="kw">names</span>(Coauthors)=<span class="st">&#39;Coauthors&#39;</span></a>
<a class="sourceLine" id="cb541-6" title="6"><span class="kw">head</span>(Coauthors)</a></code></pre></div>
<pre><code>## [1] Coauthors
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<div id="alternative-graphics" class="section level2">
<h2><span class="header-section-number">5.3</span> Alternative graphics</h2>
<div id="introducing-ggvis" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Introducing ggvis</h3>
<p>By now we are familiar with using the <code>ggplot2</code> package instead of the base R graphics engine to produce figures. Now we’re going to look at another package, <code>ggvis</code>, which you’ll notice has the same graph building philosophy, albeit with a slightly different syntax. Install the package and then load it,</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb543-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;ggvis&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" title="1"><span class="kw">library</span>(ggvis)</a></code></pre></div>
<p>We’re going to practice some of the basics of <code>ggvis</code> with a demo dataset that can be found in the R base package. The <code>mtcars</code> dataset contains data on 32 cars from 1973–74. Let’s start by plotting the horsepower against the miles per gallon.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb545-1" title="1"><span class="co"># first layer is the points of a scatter plot</span></a>
<a class="sourceLine" id="cb545-2" title="2"><span class="co"># second layer is a simple linear model, </span></a>
<a class="sourceLine" id="cb545-3" title="3"><span class="co"># SE=TRUE displays confidence bans around the predictions</span></a>
<a class="sourceLine" id="cb545-4" title="4">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb545-5" title="5"><span class="st">  </span><span class="kw">ggvis</span>(<span class="op">~</span>hp, <span class="op">~</span>mpg, <span class="dt">fill :=</span> <span class="st">&quot;red&quot;</span>, <span class="dt">stroke :=</span> <span class="st">&quot;black&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb545-6" title="6"><span class="st">  </span><span class="kw">layer_points</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb545-7" title="7"><span class="st">  </span><span class="kw">layer_model_predictions</span>(<span class="dt">model=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">TRUE</span>) </a></code></pre></div>
<p>This plot can be broken down into smaller components in the same as <code>ggplot</code> graphics are built-up from smaller components. We’re plotting the data and overlaying a straight line, which is the prediction from a linear model that we’ve fitted to the data. We have also added pointwise 95% confidence interval bands to our linear model.</p>
<p><img src="week5/ggvis-lm-fit.png" width="\linewidth" />
Horsepower is related to the number of cylinders in the engine. So let’s group the data into number of cylinders and then, treating each group independently, fit a new linear model. Therefore, we are fitting a piecewise linear model.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" title="1"><span class="co">#piecewise linear</span></a>
<a class="sourceLine" id="cb546-2" title="2">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb546-3" title="3"><span class="st">  </span><span class="kw">ggvis</span>(<span class="op">~</span>wt, <span class="op">~</span>mpg, <span class="dt">fill =</span> <span class="op">~</span><span class="kw">factor</span>(cyl)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb546-4" title="4"><span class="st">  </span><span class="kw">layer_points</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb546-5" title="5"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb546-6" title="6"><span class="st">  </span><span class="kw">layer_model_predictions</span>(<span class="dt">model =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb546-7" title="7"><span class="co"># the group_by(cyl) tells next layer to group by cylinder factor</span></a></code></pre></div>
<p>The plot shows three separate lines, with their corresponding 95% confidence intervals.</p>
<div class="figure"><span id="fig:unnamed-chunk-233"></span>
<img src="week5/ggvis-piecewise-linear.png" alt="Piecewise linear model plot using `ggvis`." width="\linewidth" />
<p class="caption">
Figure 5.2: Piecewise linear model plot using <code>ggvis</code>.
</p>
</div>
</div>
<div id="interactiveresponsive-graphics" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Interactive/responsive graphics</h3>
<p>You might be wondering, why should I use <code>ggvis</code> when I can use <code>ggplot</code>? One of the main advantages of <code>ggvis</code> is that you can make your graphics interactive (they will be viewed with a browser to achieve this). This can be particularly cool if you want to embed your graphics in a responsive web environment, or you wish to manipulate features of the plot to gain a deeper insight into the data you’re plotting.</p>
<p>The following code generates a basic interactive plot.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb547-1" title="1"><span class="co"># In this plot we have:</span></a>
<a class="sourceLine" id="cb547-2" title="2"><span class="co"># a smoothing layer with input selection for span</span></a>
<a class="sourceLine" id="cb547-3" title="3"><span class="co"># and a point layer with input selection for size</span></a>
<a class="sourceLine" id="cb547-4" title="4">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb547-5" title="5"><span class="st">  </span><span class="kw">ggvis</span>(<span class="op">~</span>wt, <span class="op">~</span>mpg, <span class="dt">fill :=</span> <span class="st">&quot;purple&quot;</span>, <span class="dt">stroke :=</span> <span class="st">&quot;black&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb547-6" title="6"><span class="st">  </span><span class="kw">layer_smooths</span>(<span class="dt">span =</span> <span class="kw">input_slider</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dt">value =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb547-7" title="7"><span class="st">  </span><span class="kw">layer_points</span>(<span class="dt">size :=</span> <span class="kw">input_slider</span>(<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">100</span>)) </a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-235"></span>
<img src="week5/ggvis-interactive.png" alt="Interactive plot using `ggvis`. When viewed in the RStudio Viewer or in a web browser you can move the sliders at the bottom with your mouse." width="\linewidth" />
<p class="caption">
Figure 5.3: Interactive plot using <code>ggvis</code>. When viewed in the RStudio Viewer or in a web browser you can move the sliders at the bottom with your mouse.
</p>
</div>
<p>This particular plot has two sliders which you can play with to:</p>
<ul>
<li>adjust the size of the data points;</li>
<li>adjust the smoothness of the line.</li>
</ul>
<p>If you decrease the smoothness, then the line will start to become more wobbly and intersect more points, whereas if you increase the smoothness, the line will instead capture the general shape of the data, rather than specific points.</p>
<p>Note the message in the RStudio Console “Showing dynamic visualisation. Press Escape/Ctrl + C to stop”. You must press either of these key combinations, or the Stop icon in the RStudio Viewer, to continue submitting R commands in your R session.</p>
<p>When modelling a dataset we often make assumptions about how the data is generated. For example, do the residuals follow an underlying Normal distribution, and if so, can we estimate it’s parameters. Alternatively, the data may be distributed as a Poisson, Gamma, or Chi-squared distribution. It’s not always appropriate to assume that the data fits some pre-specified distributional family, especially if we don’t have a lot of data. Instead, we may want to model the data without making such distributional assumptions. In statistics this is known as nonparametrics, and the most common type of nonparametric density estimation is <em>kernel density estimation</em>. Further details can be found here <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation" class="uri">https://en.wikipedia.org/wiki/Kernel_density_estimation</a>.</p>
<p>Essentially kernel density estimation replaces each data point with a kernel function (e.g. Gaussian, Epanechnikov), and aims to approximate the underlying population density by smoothing your data (which is assumed to be a sample from the population).</p>
<p>Run the code below and see what happens when you change the kernel function and smoothing parameter (more commonly known as the bandwidth).</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" title="1"><span class="co"># In this plot we have an input slider to select the bandwidth of smoother</span></a>
<a class="sourceLine" id="cb548-2" title="2">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb548-3" title="3">	<span class="kw">ggvis</span>(<span class="op">~</span>wt) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb548-4" title="4">	<span class="kw">layer_densities</span>(</a>
<a class="sourceLine" id="cb548-5" title="5">	<span class="dt">adjust =</span> <span class="kw">input_slider</span>(.<span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">value =</span> <span class="dv">1</span>, <span class="dt">step =</span> <span class="fl">.1</span>, </a>
<a class="sourceLine" id="cb548-6" title="6">		<span class="dt">label =</span> <span class="st">&quot;Bandwidth adjustment&quot;</span>), </a>
<a class="sourceLine" id="cb548-7" title="7">	<span class="dt">kernel =</span> <span class="kw">input_select</span>(</a>
<a class="sourceLine" id="cb548-8" title="8">		<span class="kw">c</span>(<span class="st">&quot;Gaussian&quot;</span> =<span class="st"> &quot;gaussian&quot;</span>,</a>
<a class="sourceLine" id="cb548-9" title="9">		<span class="st">&quot;Epanechnikov&quot;</span> =<span class="st"> &quot;epanechnikov&quot;</span>,</a>
<a class="sourceLine" id="cb548-10" title="10">		<span class="st">&quot;Rectangular&quot;</span> =<span class="st"> &quot;rectangular&quot;</span>,</a>
<a class="sourceLine" id="cb548-11" title="11">		<span class="st">&quot;Triangular&quot;</span> =<span class="st"> &quot;triangular&quot;</span>,</a>
<a class="sourceLine" id="cb548-12" title="12">		<span class="st">&quot;Biweight&quot;</span> =<span class="st"> &quot;biweight&quot;</span>,</a>
<a class="sourceLine" id="cb548-13" title="13">		<span class="st">&quot;Cosine&quot;</span> =<span class="st"> &quot;cosine&quot;</span>,</a>
<a class="sourceLine" id="cb548-14" title="14">		<span class="st">&quot;Optcosine&quot;</span> =<span class="st"> &quot;optcosine&quot;</span>),</a>
<a class="sourceLine" id="cb548-15" title="15">	<span class="dt">label =</span> <span class="st">&quot;Kernel&quot;</span>)</a>
<a class="sourceLine" id="cb548-16" title="16">	)</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-237"></span>
<img src="week5/ggvis-interactive-2.png" alt="Another interactive plot using `ggvis`." width="\linewidth" />
<p class="caption">
Figure 5.4: Another interactive plot using <code>ggvis</code>.
</p>
</div>
<p>The plot allows you to choose which kernel you are using and also to adjust the bandwidth. This is much more convenient than plotting many different plots.</p>
</div>
</div>
<div id="shiny-web-applications" class="section level2">
<h2><span class="header-section-number">5.4</span> Shiny Web Applications</h2>
<p>The team behind RStudio have created an application framework which allows the user to create web pages which R code. One example, of this is we can create interactive plots like those generated by <code>ggvis</code>.</p>
<p>To create a new app in RStudio follow this procedure:</p>
<ul>
<li>click the New icon | Shiny Web App…</li>
<li>Give yours a name with no spaces such as ``example-shiny-app’’.</li>
<li>Choose the single of multiple file approach to coding the app (it doesn’t really matter which you choose)</li>
<li>and choose which directory (folder) that you want to make it in.</li>
</ul>
<p>If you chose the single file approach you now get a single file called <code>app.R</code> to edit. However the placeholder code provided by RStudio will actually run. Click the “Run App” button in the top right corner of the Source pane. RStudio will open a new Viewer window running the app.</p>
<div class="figure"><span id="fig:unnamed-chunk-238"></span>
<img src="week5/example-shiny-app.png" alt="Example Shiny App by RStudio." width="\linewidth" />
<p class="caption">
Figure 5.5: Example Shiny App by RStudio.
</p>
</div>
<p>As with the <code>ggvis</code> interactive plots you see that you can move the slider with your mouse and R recalculates and redraws the plot. Experiment with moving the slider.</p>
<p>Shiny Apps are very flexible because they need not just produce plots but they provide Web frontends to any type of R code. So you could be providing access to web scraping code or access to a database.</p>
<p>Inspect the structure of the code. It is very simple. There are two main functions <code>ui()</code> (which stands for user-interface) and <code>server()</code> which is the part of the code doing the computation/plots. You would edit these functions to perform the task you needed to achieve.</p>
<p>Whilst your app is running you will notice that the RStudio console reports “Listening on <a href="http://127.0.0.1:4122" class="uri">http://127.0.0.1:4122</a>”. In order to be able to resume your R session you must close the window your app is running in.</p>
<div id="other-rstudio-features-we-havent-covered" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Other RStudio features we haven’t covered</h3>
<p>RStudio has many features we haven’t covered. It has brilliant features when you are building your own package (personally I would never build a package outside of RStudio anymore). When building a package and some other tasks you need the RStudio “Build” pane. To see this I think you must define the top level directory for your package (or bookdown book etc.) as an RStudio project. This creates an <code>.Rproj</code> file in the directory which RStudio detects and then shows the Build pane.</p>
<p>RStudio can also run Sweave documents (which contain both LaTeX and R code) and also many types of presentation including LaTeX beamer and RStudio’s <code>.Rpres</code> format.</p>
</div>
</div>
<div id="rmarkdown-html-notebooks-and-ipythonjupyter-notebooks" class="section level2">
<h2><span class="header-section-number">5.5</span> Rmarkdown HTML notebooks and Ipython/Jupyter notebooks</h2>
<p>An advanced type of Rmarkdown document is an “R Notebook”. These are R markdown files with the <code>output</code> in the YAML header defined as</p>
<pre><code>output:
  html_notebook: default</code></pre>
<p>When you first save an Rmarkdown file with this output definition its output file with extension <code>.nb.html</code> is created immediately (even if you have not evaluated any of your code blocks).</p>
<p>The <code>.nb.html</code> file format is very clever because it actually contains the Rmarkdown code as well as the html output. Therefore, if you open an <code>.nb.html</code> file in RStudio it will show the associated <code>.Rmd</code> code even if you don’t have that separate file.</p>
<p>The R output shown in the <code>.nb.html</code> file is the output from the code blocks which have been run, i.e. if you have not evaluated all of the R code blocks in your Rmd file then not all of the output will be present in the <code>.nb.html</code> file.</p>
<p>The other main notebook format used in Data Science are Ipython/Jupyter notebooks <a href="http://jupyter.org/" class="uri">http://jupyter.org/</a>. These keep the R read-evaluation-print-loop running in the background so you can evaluate one cell of code at a time live in your browser. A screen shot of an example notebook is shown at side of the page.</p>
<div class="figure"><span id="fig:unnamed-chunk-239"></span>
<img src="week5/jupyter-notebook-example.png" alt="Example Jupyter notebook." width="\linewidth" />
<p class="caption">
Figure 5.6: Example Jupyter notebook.
</p>
</div>
<p>To try a Jupyter notebook without having to install it on your local machine, you can try it in a browser at <a href="https://try.jupyter.org/" class="uri">https://try.jupyter.org/</a>. However, my personal experience of this website is not good. Either the R kernel dies or you cannot get a space to launch a notebook. Running Jupyter notebooks on my own machine has been reliable.</p>
<p>If you want to try such notebooks installation instructions are here: <a href="http://jupyter.org/install.html" class="uri">http://jupyter.org/install.html</a>. This is easiest to do on your own computer. If you are on a University Windows network computer these will probably fail. One element of getting Jupyter notebooks running is installing the IPython/Jupyter R kernel (the notebooks can use kernels for other languages such as Python, Julia, and many other languages). Instructions can be found here <a href="https://irkernel.github.io/installation/" class="uri">https://irkernel.github.io/installation/</a>.</p>
</div>
<div id="exercise-housing-in-new-york-city" class="section level2">
<h2><span class="header-section-number">5.6</span> Exercise: Housing in New York City</h2>
<p>We’ve now covered the basics of the <code>rvest</code> and <code>ggvis</code> packages. We’re now going look at combining these packages, along with others (including <code>dplyr</code>) to perform statistical analysis on dataset we have scraped from the web.</p>
<p>If you have installed the <code>tidyverse</code> package hopefully that has given you the <code>purrr</code> and <code>readr</code> packages already.</p>
<p>New York city contains some of the most expensive property in the world, particularly Manhattan. The property market is a rich source of data which contains many interesting nuances. For example, just because a property is big, doesn’t mean it’s expensive.</p>
<p>Have a look at <a href="https://www.zillow.com" class="uri">https://www.zillow.com</a> to get an idea of its layout. Try searching for some property, anywhere in the USA will do, and you’ll notice that the web page of the search results is split into two halves. There’s a map and a series of photo cards. Pulling data from the map, or overlaying data onto a map is possible with the <code>ggvis</code> package, but a little beyond what we’re going to cover today.<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a></p>
<p>Instead we’re going to focus on the photo cards which contain textual information.</p>
<p>The code below will extract the address, price, size, and the number of bedrooms and bathrooms of each property in the search results:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" title="1"><span class="co"># Note that this web address is quite long here so I&#39;ve split it </span></a>
<a class="sourceLine" id="cb550-2" title="2"><span class="co"># over several lines using paste0(), but you could just have it on the same line</span></a>
<a class="sourceLine" id="cb550-3" title="3"></a>
<a class="sourceLine" id="cb550-4" title="4">page &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="kw">paste0</span>(<span class="st">&quot;http://www.zillow.com/homes/for_sale/&quot;</span>,  <span class="st">&quot;Manhattan-New-York-NY/12530_rid/globalrelevanceex_sort/&quot;</span>, <span class="st">&quot;40.894829,-73.795167,40.664754,-74.151879_rect/11_zm/1_p/&quot;</span>))</a>
<a class="sourceLine" id="cb550-5" title="5"></a>
<a class="sourceLine" id="cb550-6" title="6"><span class="co"># extract html details from the photo cards</span></a>
<a class="sourceLine" id="cb550-7" title="7">houses &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-8" title="8"><span class="st">        </span><span class="kw">html_nodes</span>(<span class="st">&quot;.photo-cards li article&quot;</span>)</a>
<a class="sourceLine" id="cb550-9" title="9"></a>
<a class="sourceLine" id="cb550-10" title="10">address &lt;-<span class="st"> </span>houses <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-11" title="11"><span class="st">        </span><span class="kw">html_node</span>(<span class="st">&quot;.zsg-photo-card-address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-12" title="12"><span class="st">        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-13" title="13"><span class="st">        </span><span class="kw">gsub</span>(<span class="st">&#39;,&#39;</span>,<span class="st">&#39;&#39;</span>,.) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-14" title="14"><span class="st">        </span><span class="kw">gsub</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">s&#39;</span>,<span class="st">&#39;_&#39;</span>,.)</a>
<a class="sourceLine" id="cb550-15" title="15"></a>
<a class="sourceLine" id="cb550-16" title="16">price &lt;-<span class="st"> </span>houses <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-17" title="17"><span class="st">        </span><span class="kw">html_node</span>(<span class="st">&quot;.zsg-photo-card-price&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-18" title="18"><span class="st">        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-19" title="19"><span class="st">        </span>readr<span class="op">::</span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb550-20" title="20"></a>
<a class="sourceLine" id="cb550-21" title="21">params &lt;-<span class="st"> </span>houses <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-22" title="22"><span class="st">        </span><span class="kw">html_node</span>(<span class="st">&quot;.zsg-photo-card-info&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-23" title="23"><span class="st">        </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb550-24" title="24"><span class="st">        </span><span class="kw">strsplit</span>(<span class="st">&quot;\u00b7&quot;</span>)</a>
<a class="sourceLine" id="cb550-25" title="25"></a>
<a class="sourceLine" id="cb550-26" title="26">beds &lt;-<span class="st"> </span>params <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-27" title="27">		purrr<span class="op">::</span><span class="kw">map_chr</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-28" title="28">		<span class="kw">gsub</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">D&#39;</span>,<span class="st">&#39;&#39;</span>,.)</a>
<a class="sourceLine" id="cb550-29" title="29">		</a>
<a class="sourceLine" id="cb550-30" title="30">baths &lt;-<span class="st"> </span>params <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-31" title="31">	purrr<span class="op">::</span><span class="kw">map_chr</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-32" title="32">	readr<span class="op">::</span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb550-33" title="33">	</a>
<a class="sourceLine" id="cb550-34" title="34">house_area &lt;-<span class="st"> </span>params <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-35" title="35">		purrr<span class="op">::</span><span class="kw">map_chr</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb550-36" title="36">		<span class="kw">gsub</span>(<span class="st">&#39;</span><span class="ch">\\</span><span class="st">D&#39;</span>,<span class="st">&#39;&#39;</span>,.)</a>
<a class="sourceLine" id="cb550-37" title="37"></a>
<a class="sourceLine" id="cb550-38" title="38">ny_housing &lt;-<span class="st"> </span><span class="kw">data.frame</span>(address, price, beds, baths, house_area)</a></code></pre></div>
<p>You may get some warnings when you run this code. Let’s ignore those for the moment. You’ll find scraping data from website is never trivial. Web developers design their sites to be pretty and not scraper friendly. Companies that specialise in web scraping spend a significant portion of their time updating scrapers when websites are updated.</p>
<p>Your task is to utilise what you’ve learnt over the past few weeks to perform some statistical analyses on these data. Here are some suggestions for things to explore.</p>
<ul>
<li>It’s always a good idea to take a look at the data. The two most obvious functions to use here would be <code>View()</code> and <code>head()</code>.</li>
<li>It’s also a good idea to look at some simple summary statistics, such as mean, median, max, etc. Another useful function for summarising your data is <code>summary()</code>. Note that this function will only work on numeric class data. If there are any non-numeric values in your data fix your data frame so that the appropriate columns are of class numeric.</li>
<li>You’ll notice that in the raw data that “Studio” often appears under “number of bedrooms”, really we’d want a number so that we can do summaries on the data. Here I’ve just removed anything that’s not a number, can you do something better?</li>
<li>As we saw with the Google Scholar data, when we scrape data from a website we’re only scraping what is on that particular page. This is fine, but if the data we want is over multiple pages then we need to be clever. Try to use a <code>for</code> loop to loop over each webpage and scrape the data you want. <em>Hint: Most websites follow a logical naming and numbering structure.</em></li>
<li>Create an interactive <code>ggvis</code> plot to explore one or more variables.</li>
<li>As I’ve already mentioned, location is a very important factor. The longitude and latitude for each property is availble (hint: look at <code>houses[[1]]</code>). Can you extract this data and plot the search results either on a grid or map and highlight the expensive parts of the city?</li>
</ul>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="15">
<li id="fn15"><p>R was not really designed for this sort of task. Other programming languages, such as Python, are generally better for web scraping.<a href="web-app.html#fnref15" class="footnote-back">↩</a></p></li>
<li id="fn16"><p>Search for this in the Chrome Web Store <a href="https://chrome.google.com/webstore/category/extensions" class="uri">https://chrome.google.com/webstore/category/extensions</a><a href="web-app.html#fnref16" class="footnote-back">↩</a></p></li>
<li id="fn17"><p>You can think of the <code>readr::parse_number()</code> function as a more advanced version of <code>as.numeric()</code>.<a href="web-app.html#fnref17" class="footnote-back">↩</a></p></li>
<li id="fn18"><p>Location is an important factor when determining price so filtering properties based on area would certainly be interesting.<a href="web-app.html#fnref18" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="string.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="further-reading.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
