<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Loops, Conditional Statements, and Simulation | Lancaster University MATH550/SCC.461 R Programming</title>
  <meta name="description" content="2 Loops, Conditional Statements, and Simulation | Lancaster University MATH550/SCC.461 R Programming" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Loops, Conditional Statements, and Simulation | Lancaster University MATH550/SCC.461 R Programming" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Loops, Conditional Statements, and Simulation | Lancaster University MATH550/SCC.461 R Programming" />
  
  
  

<meta name="author" content="Lecturer: Dr Clement Lee" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-manipulation-and-plotting-in-r.html"/>
<link rel="next" href="time-manipulation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li><a href="introduction-to-r.html#introduction-to-r"><strong>0</strong> Introduction to R</a><ul>
<li class="chapter" data-level="0.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>0.1</b> Background</a></li>
<li class="chapter" data-level="0.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#saving-your-work"><i class="fa fa-check"></i><b>0.2</b> Saving your work</a></li>
<li class="chapter" data-level="0.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started"><i class="fa fa-check"></i><b>0.3</b> Getting started</a></li>
<li class="chapter" data-level="0.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-help"><i class="fa fa-check"></i><b>0.4</b> Getting Help</a></li>
<li class="chapter" data-level="0.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-scripts"><i class="fa fa-check"></i><b>0.5</b> R scripts</a></li>
<li class="chapter" data-level="0.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>0.6</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-manipulation-and-plotting-in-r.html"><a href="data-manipulation-and-plotting-in-r.html"><i class="fa fa-check"></i><b>1</b> Data manipulation and plotting in R</a><ul>
<li class="chapter" data-level="1.1" data-path="data-manipulation-and-plotting-in-r.html"><a href="data-manipulation-and-plotting-in-r.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="data-manipulation-and-plotting-in-r.html"><a href="data-manipulation-and-plotting-in-r.html#working-with-data-in-r"><i class="fa fa-check"></i><b>1.2</b> Working with data in R</a></li>
<li class="chapter" data-level="1.3" data-path="data-manipulation-and-plotting-in-r.html"><a href="data-manipulation-and-plotting-in-r.html#data-types"><i class="fa fa-check"></i><b>1.3</b> Data Types</a></li>
<li class="chapter" data-level="1.4" data-path="data-manipulation-and-plotting-in-r.html"><a href="data-manipulation-and-plotting-in-r.html#logical-comparisons-and-boolean-operations"><i class="fa fa-check"></i><b>1.4</b> Logical comparisons and Boolean operations</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-plots"><i class="fa fa-check"></i><b>1.5</b> Basic Plots</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="loops-conditional-statements-and-simulation.html"><a href="loops-conditional-statements-and-simulation.html"><i class="fa fa-check"></i><b>2</b> Loops, Conditional Statements, and Simulation</a><ul>
<li class="chapter" data-level="2.1" data-path="loops-conditional-statements-and-simulation.html"><a href="loops-conditional-statements-and-simulation.html#before-you-start"><i class="fa fa-check"></i><b>2.1</b> Before you start</a></li>
<li class="chapter" data-level="2.2" data-path="loops-conditional-statements-and-simulation.html"><a href="loops-conditional-statements-and-simulation.html#loops"><i class="fa fa-check"></i><b>2.2</b> Loops</a></li>
<li class="chapter" data-level="2.3" data-path="loops-conditional-statements-and-simulation.html"><a href="loops-conditional-statements-and-simulation.html#conditional-statements"><i class="fa fa-check"></i><b>2.3</b> Conditional statements</a></li>
<li class="chapter" data-level="2.4" data-path="loops-conditional-statements-and-simulation.html"><a href="loops-conditional-statements-and-simulation.html#probability-and-simulation"><i class="fa fa-check"></i><b>2.4</b> Probability and Simulation</a></li>
<li class="chapter" data-level="2.5" data-path="loops-conditional-statements-and-simulation.html"><a href="loops-conditional-statements-and-simulation.html#combining-loops-and-simulation"><i class="fa fa-check"></i><b>2.5</b> Combining Loops and Simulation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="time-manipulation.html"><a href="time-manipulation.html"><i class="fa fa-check"></i><b>3</b> Time manipulation</a><ul>
<li class="chapter" data-level="3.1" data-path="time-manipulation.html"><a href="time-manipulation.html#from-last-week"><i class="fa fa-check"></i><b>3.1</b> From last week</a></li>
<li class="chapter" data-level="3.2" data-path="time-manipulation.html"><a href="time-manipulation.html#dates-and-timestamps-in-r"><i class="fa fa-check"></i><b>3.2</b> Dates and timestamps in R</a></li>
<li class="chapter" data-level="3.3" data-path="time-manipulation.html"><a href="time-manipulation.html#summarising-data-over-time"><i class="fa fa-check"></i><b>3.3</b> Summarising data over time</a></li>
<li class="chapter" data-level="3.4" data-path="time-manipulation.html"><a href="time-manipulation.html#a-timestamp-split-over-several-columns"><i class="fa fa-check"></i><b>3.4</b> A timestamp split over several columns</a></li>
<li class="chapter" data-level="3.5" data-path="time-manipulation.html"><a href="time-manipulation.html#time-zones"><i class="fa fa-check"></i><b>3.5</b> Time zones</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="string-processing.html"><a href="string-processing.html"><i class="fa fa-check"></i><b>4</b> String processing</a><ul>
<li class="chapter" data-level="4.1" data-path="string-processing.html"><a href="string-processing.html#preamble"><i class="fa fa-check"></i><b>4.1</b> Preamble</a></li>
<li class="chapter" data-level="4.2" data-path="string-processing.html"><a href="string-processing.html#introducing-regular-expressions"><i class="fa fa-check"></i><b>4.2</b> Introducing regular expressions</a></li>
<li class="chapter" data-level="4.3" data-path="string-processing.html"><a href="string-processing.html#working-with-strings-and-regular-expressions"><i class="fa fa-check"></i><b>4.3</b> Working with strings and regular expressions</a></li>
<li class="chapter" data-level="4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#exercises"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><i class="fa fa-check"></i><b>5</b> Web scraping, interactive graphics, Shiny Apps, package building, and more</a><ul>
<li class="chapter" data-level="5.1" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html#packages"><i class="fa fa-check"></i><b>5.1</b> Packages</a></li>
<li class="chapter" data-level="5.2" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html#collecting-data"><i class="fa fa-check"></i><b>5.2</b> Collecting data</a></li>
<li class="chapter" data-level="5.3" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html#alternative-graphics"><i class="fa fa-check"></i><b>5.3</b> Alternative graphics</a></li>
<li class="chapter" data-level="5.4" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html#shiny-web-applications"><i class="fa fa-check"></i><b>5.4</b> Shiny Web Applications</a></li>
<li class="chapter" data-level="5.5" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html#rmarkdown-html-notebooks-and-ipythonjupyter-notebooks"><i class="fa fa-check"></i><b>5.5</b> Rmarkdown HTML notebooks and Ipython/Jupyter notebooks</a></li>
<li class="chapter" data-level="5.6" data-path="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html"><a href="web-scraping-interactive-graphics-shiny-apps-package-building-and-more.html#exercise-housing-in-new-york-city"><i class="fa fa-check"></i><b>5.6</b> Exercise: Housing in New York City</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="further-reading.html"><a href="further-reading.html"><i class="fa fa-check"></i>Further reading</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Lancaster University MATH550/SCC.461 R Programming</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="loops-conditional-statements-and-simulation" class="section level1">
<h1><span class="header-section-number">2</span> Loops, Conditional Statements, and Simulation</h1>
<div id="before-you-start" class="section level2">
<h2><span class="header-section-number">2.1</span> Before you start</h2>
<ul>
<li>Compare your submission for last week’s coursework with the solution that
is on moodle. Look for differences. Make sure to integrate any improvements
in style into this week’s code.</li>
<li>Revise the Summary sections on Data Manipulation and Basic Plots from
last weeks Lab. Also scan through the section on Logical Comparisons.
You will be making use of this knowledge this week.</li>
<li>As usual, to save the code you write for this lab, create a new
R notebook (or script) in your R progamming folder, on your H drive,</li>
<li>Write a few introductory comments at the top stating that this script covers
the basics of looping, writing conditional statwments, and simulating
probabilities.</li>
<li>Add your favourite libraries:</li>
</ul>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb256-2" title="2"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<p>Or indeed,</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<ul>
<li>As you work through each section in the lab notes, consider adding a section break in your script. Note that in an R script the new sectioning markup in RStudio works by detecting the name within <code># ----</code> such as</li>
</ul>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" title="1"><span class="co"># Loops ----</span></a></code></pre></div>
<p>as a section title in your script. You can then use RStudio editor controls to jump to different places in your script.</p>
<p>Or use markdown section headings in your R markdown notebook, e.g.</p>
<pre><code># Level 1 heading

## Level 2 heading</code></pre>
<ul>
<li>For each of the exercise questions consider starting a new script entirely.</li>
<li>The purpose of this lab is to get you writing and thinking about <code>for</code> loops and conditional statements, also known as <code>if</code> statements. The second half of the lab focuses on probability simulation.</li>
</ul>
</div>
<div id="loops" class="section level2">
<h2><span class="header-section-number">2.2</span> Loops</h2>
<p>Wrapping a block of code inside a <code>for</code> loop, means that the code can
be repeatedly executed. Because of this, a <code>for</code> loop is classified as an
iteration statement; we repeatedly iterate over the same code, with, typically,
only one or two parameters changing each time.</p>
<p>For instance, a <code>for</code> loop can be used to make the following
sequence of numbers. Can you see the pattern?</p>
<p>1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, …</p>
<p>The sequence is known as the Fibonacci sequence which is calculated as
follows; starting with 1 and 1, each subsequent number is the sum of the previous two. We will use this sequence as an example for learning about loops in R.</p>
<p>First, we will need to cover another way to pick out individual elements
from a vector. We have seen in previous labs, that we can use
<code>filter()</code> to reduce a data frame. And we have seen that we can pass
a logical vector (a vector containing a series of <code>TRUE</code> and <code>FALSE</code> values)
to select out elements of a different vector:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1">x &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">5</span></a>
<a class="sourceLine" id="cb260-2" title="2">which &lt;-<span class="st"> </span>x <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb260-3" title="3">which</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" title="1">x[which]</a></code></pre></div>
<pre><code>## [1] 0 1 2</code></pre>
<p>Here, we will be using the index method. In your <strong>script</strong>, store the
first six numbers of the Fibonacci sequence in a vector, and run this.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" title="1">fib &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>)</a></code></pre></div>
<p>Now, in order to access the third element, we use square brackets:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" title="1">fib[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>In order to extract a larger subset we specify a vector of indices, or we
can use the colon shortcut:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" title="1">fib[<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)]</a></code></pre></div>
<pre><code>## [1] 2 3 5</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" title="1">fib[<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>## [1] 2 3 5</code></pre>
<p>To generalise, if <code>x</code> is a vector, and <code>i</code> is a positive
integer, then <code>x[i]</code>, will be the <strong>i</strong>th element of <code>x</code>.
And if <code>y</code> is a vector of positive integers, then <code>x[y]</code>
gives the corresponding elements of <code>x</code> as a vector (note that some programming languages like python are zero based which means the first element of a vector is referred to as <code>x[0]</code>).</p>
<div id="writing-a-for-loop" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Writing a for loop</h3>
<p>We can use a <code>for</code> loop to calculate, say, the first 100 numbers
of the Fibonacci sequence. In order to do this, we first need to understand
two things;</p>
<ol style="list-style-type: decimal">
<li>that this particular sequence has a recursive property,
and</li>
<li>loops are one way in which we can implement such properties.</li>
</ol>
<p>What do we mean by <strong>recursive</strong>? Well, instead of writing out the
Fibonacci as just a sequence of numbers, we could instead use algebra:</p>
<p>1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, …</p>
<p><span class="math inline">\(r_1\)</span>, <span class="math inline">\(r_2\)</span>, <span class="math inline">\(r_3\)</span>, <span class="math inline">\(r_4\)</span>, <span class="math inline">\(r_5\)</span>, <span class="math inline">\(r_6\)</span>, <span class="math inline">\(r_7\)</span>, <span class="math inline">\(r_8\)</span>, <span class="math inline">\(r_9\)</span>, <span class="math inline">\(r_{10}\)</span>, <span class="math inline">\(r_{11}\)</span>, <span class="math inline">\(r_{12}\)</span>, …</p>
<p>We already stated that, after the first two numbers, each subsequent number is
the sum of the previous two. Written mathematically this looks like:</p>
<p><span class="math display">\[
r_{i} = r_{i-1} + r_{i-2} \quad \text{for}\quad i &gt; 2.
\]</span></p>
<p>So, the idea is to write code that lets <code>i</code> go from 3 up to 100,
and as it does so, we calculate the <strong>i</strong>th value of the Fibonacci sequence,
storing the results in a vector:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" title="1"><span class="co"># parameters</span></a>
<a class="sourceLine" id="cb271-2" title="2">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb271-3" title="3">r &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>) <span class="co"># first two values</span></a>
<a class="sourceLine" id="cb271-4" title="4"></a>
<a class="sourceLine" id="cb271-5" title="5"><span class="co"># Fibonacci algorithm</span></a>
<a class="sourceLine" id="cb271-6" title="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb271-7" title="7">	r[i] &lt;-<span class="st"> </span>r[i<span class="dv">-1</span>] <span class="op">+</span><span class="st"> </span>r[i<span class="dv">-2</span>]</a>
<a class="sourceLine" id="cb271-8" title="8">}</a></code></pre></div>
<p>Before you run the script, let us examine what is happening line-by-line.
The two lines under the heading <code># parameters</code> set-up the
workspace; <code>n</code> contains the how many numbers we want to generate,
and <code>r</code> initialises the sequence.</p>
<p>The next section defines the Fibonacci sequence using a for loop.
There are two parts to specifying a <code>for</code> loop. There is the index
which is specified in the round brackets, and then there is the code to be
repeated between the curly brackets:</p>
<p><img src="week2/loop.png" width="0.7\linewidth" /></p>
<p>When specifying the index we use the phrase <code>in</code> rather than
a equals symbol.</p>
<p>If everything goes well, when you run the code your <code>r</code> vector
should now contain 100 elements, you should check this. Also check some
of the elements against the sequence stated above. For instance the 12th
number should be 144.</p>
</div>
<div id="population-growth" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Population growth</h3>
<p>The Fibonacci sequence might seem a little too abstract of a concept to justify
why you should be interested in loops. So, let us take another example;
wildlife population growth models.</p>
<p>Wild animals typically go through three stages as part of their life-history;
juvenile, subadult, and adult. With juveniles being defined as those
being born within one time-period (typically a year). Subadults are no
longer juveniles, but still remain non-reproductive (1 to 2 years old). And adults
being the reproductive members of the population (2 or more years old).</p>
<p>The reason why we separate juveniles and subadults, is that juveniles often
have a much lower rate of survival than subadults. With adults having an even
greater rate of survival year-on-year, than the other two.</p>
<p>So, with population growth modelling, the idea is that given a starting size
for each of these subgroups, the survival/death rate of each subgroup, and the
reproductive rate of the adults, we should then be able to simulate what we
expect to happen to the subpopulations over time.</p>
<p>To keep track of the size of population subgroups, we let <span class="math inline">\(J\)</span>, <span class="math inline">\(S\)</span> and <span class="math inline">\(A\)</span>
represent the size of the juveniles, subadults, and adults, respectively.
Each of these numbers will change over time, such that <span class="math inline">\(J_t\)</span> will represent
the size of the juvenile group at time <span class="math inline">\(t\)</span>.</p>
<p>To begin specifying models for how the subgroups change over time, let us start
with the easiest, the transition from Juvenile to Subadult:
<span class="math display">\[
S_{(t+1)} = p_0 J_t.
\]</span>
Where <span class="math inline">\(p_0\)</span> is the proportion that survive to the subadult stage.
Similarly, we define the proportion of subadults that survive as <span class="math inline">\(p_1\)</span>,
and adults as <span class="math inline">\(p_2\)</span>.</p>
<p><img src="week2/growth-diagram.png" width="\linewidth" /></p>
<p>The number of adults at time <span class="math inline">\(t+1\)</span> has two sources:
<span class="math display">\[
A_{(t+1)} = p_1 S_t + p_2 A_t.
\]</span>
One way to read this is in the following way; the number of subadults that
survived to adulthood plus the number of adults that have not died.</p>
<p>Finally, to model the juveniles, we need to know what proportion of the
adults produce offspring, let this be represented by <span class="math inline">\(f\)</span>. So, that the juveniles
at time <span class="math inline">\(t+1\)</span> are estimated by the equation:
<span class="math display">\[
J_{(t+1)} = f A_t.
\]</span></p>
<p>Collectively, these equations take the current sizes of each subgroup;
<span class="math inline">\(J_t, S_t, A_t\)</span>, and then calculate their size one time-period from now.</p>
<p>To implement this in R, we will use a for loop. We will store population
sizes at each time in three vectors; <code>J</code>, <code>S</code>, and
<code>A</code>, representing juveniles, subadults and adults, respectively.</p>
<p>In order to give initial sizes to the populations, as well as numbers for the
constants; <span class="math inline">\(p_0\)</span>, <span class="math inline">\(p_1\)</span>, <span class="math inline">\(p_2\)</span>, and <span class="math inline">\(f\)</span>, we need to look at a real-life case study.
For this we look towards research on the Northern Spotted Owl which is a
threatened species that lives and nests primarily in north west America,
shown in Figure <a href="loops-conditional-statements-and-simulation.html#fig:owl">2.1</a>.</p>
<p>Noon and Biles (1990) extracted estimates for these constants from various
field studies; <span class="math inline">\(p_0=0.11\)</span>, <span class="math inline">\(p_1=0.71\)</span>, <span class="math inline">\(p_2=0.94\)</span>, <span class="math inline">\(f=0.24\)</span>. These numbers
apply to female owls only, which is a common convention in population
studies of species which have a constant ratio of males and females.
Thus, our <span class="math inline">\(J\)</span>, <span class="math inline">\(S\)</span>, and <span class="math inline">\(A\)</span> parameters refer only to the number of females
at each time period.</p>
<div class="figure"><span id="fig:owl"></span>
<img src="week2/Northern_Spotted_Owl.jpg" alt="Northern spotted owl, a near threatened species whose wingspan is approximately one metre." width="\linewidth" />
<p class="caption">
Figure 2.1: Northern spotted owl, a near threatened species whose wingspan is approximately one metre.
</p>
</div>
<p>To implement the population growth model of female northern spotted owls, we have
several tasks in front of us:</p>
<ol style="list-style-type: decimal">
<li><p>Start a new script. Add a series of comments at the top outlining
what the script will do.</p></li>
<li><p>Define the number of years we wish to project for.</p></li>
</ol>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1">  years &lt;-<span class="st"> </span><span class="dv">20</span></a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p>Define the constants from the text above as objects.</p></li>
<li><p>Create three vectors to store the population sizes of each of the age
groups. At the start, the vectors should only contain the following initial
population sizes:</p></li>
</ol>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" title="1">J &lt;-<span class="st"> </span><span class="dv">1200</span></a>
<a class="sourceLine" id="cb273-2" title="2">S &lt;-<span class="st"> </span><span class="dv">800</span></a>
<a class="sourceLine" id="cb273-3" title="3">A &lt;-<span class="st"> </span><span class="dv">2000</span></a></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Construct a <code>for</code> loop with an index to represent time:</li>
</ol>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1"><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>years) {</a>
<a class="sourceLine" id="cb274-2" title="2">	<span class="co"># population equations go here</span></a>
<a class="sourceLine" id="cb274-3" title="3">}</a></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Put the three population equations inside the for loop, using the
index to pick out appropriate elements of the vectors. And store our
new estimates. For example, adding the subadult equation would look like:</li>
</ol>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" title="1"><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(years<span class="dv">-1</span>)) {</a>
<a class="sourceLine" id="cb275-2" title="2">	<span class="co"># subadult equation</span></a>
<a class="sourceLine" id="cb275-3" title="3">	S[t<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>p0<span class="op">*</span>J[t]</a>
<a class="sourceLine" id="cb275-4" title="4"></a>
<a class="sourceLine" id="cb275-5" title="5">	<span class="co"># adult equation goes here</span></a>
<a class="sourceLine" id="cb275-6" title="6"></a>
<a class="sourceLine" id="cb275-7" title="7">	<span class="co"># juvenile equation goes here</span></a>
<a class="sourceLine" id="cb275-8" title="8">}</a></code></pre></div>
<p>Complete for the other subgroup equations.</p>
<ol start="7" style="list-style-type: decimal">
<li>Create a  data frame called <code>owl_pop</code> with three variables; <code>time</code>, <code>group</code>, and <code>size</code>. Each row should contain the size at a single time point for one of the three subpopulations (juvenile, subadult, and adult), such that it looks like this:</li>
</ol>
<pre><code>   nrow(owl_pop)
[1] 60
   head(owl_pop)
  time group      size
1    1     J 1200.0000
2    2     J  480.0000
3    3     J  587.5200
4    4     J  574.7616
5    5     J  549.2730
6    6     J  527.3291</code></pre>
<p>To do this you will:</p>
<ul>
<li>Need to use the <code>rep()</code> function, check it’s help page for details.</li>
<li>Make sure <code>group</code> is a factor with sensible labels.</li>
<li>Ask us for help.</li>
</ul>
<ol start="8" style="list-style-type: decimal">
<li>Create a plot using <code>ggplot()</code> and <code>owl_pop</code> showing the changes in the three subpopulations over time. Things to consider:</li>
</ol>
<ul>
<li>How do you plot lines instead of points?</li>
<li>How do you tell ggplot to plot separate lines for each of the three groups in your data?</li>
<li>Are you happy with your axis labels?</li>
</ul>
<p>Your plot should look something like this:</p>
<p><img src="week2/theme-owl-pop.png" width="0.7\linewidth" /></p>
</div>
<div id="when-not-to-loop" class="section level3">
<h3><span class="header-section-number">2.2.3</span> When not to loop</h3>
<p>We have used for loops to generate data based on a model. Each new value
we calculated was based on at least one previously calculated value.
This is, pretty much, the only circumstances in which for looping is
definitely the answer. Often with data problems it is very tempting to
create a solution using a for loop, but what you might find, especially in
R, is that your solution takes a long time to run. When this happens
there is frequently an alternative solution which involves using vectors
instead. For a trivial example, say, we have an incredibly long vector which
want to square:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" title="1"><span class="co"># for-loop method</span></a>
<a class="sourceLine" id="cb277-2" title="2">square_x_loop &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb277-3" title="3">	x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span><span class="op">^</span><span class="dv">7</span> <span class="co"># 10 million</span></a>
<a class="sourceLine" id="cb277-4" title="4"></a>
<a class="sourceLine" id="cb277-5" title="5">	<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)) {</a>
<a class="sourceLine" id="cb277-6" title="6">		x[i] &lt;-<span class="st"> </span>x[i]<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb277-7" title="7">	}</a>
<a class="sourceLine" id="cb277-8" title="8">	<span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb277-9" title="9">}</a>
<a class="sourceLine" id="cb277-10" title="10"></a>
<a class="sourceLine" id="cb277-11" title="11"><span class="co"># vector method</span></a>
<a class="sourceLine" id="cb277-12" title="12">square_x_vector &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb277-13" title="13">	x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span><span class="op">^</span><span class="dv">7</span> <span class="co"># 10 million</span></a>
<a class="sourceLine" id="cb277-14" title="14">	x &lt;-<span class="st"> </span>x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb277-15" title="15">	<span class="kw">return</span>(x)</a>
<a class="sourceLine" id="cb277-16" title="16">}</a>
<a class="sourceLine" id="cb277-17" title="17"></a>
<a class="sourceLine" id="cb277-18" title="18"><span class="co"># how much time does each method take to execute?</span></a>
<a class="sourceLine" id="cb277-19" title="19"><span class="kw">system.time</span>(<span class="kw">square_x_loop</span>())</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.762   0.020   0.782</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" title="1"><span class="kw">system.time</span>(<span class="kw">square_x_vector</span>())</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.033   0.024   0.057</code></pre>
<p>The <code>for</code> loop took longer than the vector approach. This is because of the way R is optimised for thinking with vectors, rather than thinking about processing individual values. With other more low-level programming languages you might not see any difference in terms of speed between these two methods, in fact it might even be the other way around.</p>
<p>However, you should only consider a different approach when your loop seems to
be taking a long time, and in these cases there will usually be a better way to code the solution. In all other cases where looping seems to solve your problem in a timely manner this is good enough.</p>
</div>
<div id="summary" class="section level3">
<h3><span class="header-section-number">2.2.4</span> Summary</h3>
<ul>
<li>Elements of vectors can be picked out of the vector using one or more
indexes:</li>
</ul>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)</a>
<a class="sourceLine" id="cb281-2" title="2">x[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1">x[<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>]</a></code></pre></div>
<pre><code>## [1] &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" title="1">x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)]</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;e&quot;</code></pre>
<ul>
<li><p>A <code>for</code> loop repeatedly executes a block of code. The number of repetitions
is based on the size of the sequence passed to the index. The index itself is an
object which can be used within the block of code.</p>
<p>Example:</p></li>
</ul>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)) {</a>
<a class="sourceLine" id="cb287-2" title="2">	<span class="co"># code to repeatedly execute</span></a>
<a class="sourceLine" id="cb287-3" title="3">	<span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb287-4" title="4">}</a></code></pre></div>
<ul>
<li><p>Recursive equations, or problems that involve calculating values based on previous values in the sequence are solved most excellently with <code>for</code> loops.</p></li>
<li><p>If you write a loop and it executes very slowly, cancel it, and see if there is a better approach. There usually is, and it will most likely involve vectors.
\end{enumerate}</p></li>
</ul>
</div>
</div>
<div id="conditional-statements" class="section level2">
<h2><span class="header-section-number">2.3</span> Conditional statements</h2>
<p>Like all other programming languages, R can execute a block of code conditional on whether or not a statement is true.
This is done by using the <code>if</code> command, here is one in action:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" title="1"><span class="cf">for</span> (animal <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;human&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;turtle&quot;</span>, <span class="st">&quot;zebra&quot;</span>)) {</a>
<a class="sourceLine" id="cb288-2" title="2">	<span class="co"># decide on food given to type of animal</span></a>
<a class="sourceLine" id="cb288-3" title="3">	<span class="cf">if</span> (animal <span class="op">==</span><span class="st"> &quot;cat&quot;</span>) {</a>
<a class="sourceLine" id="cb288-4" title="4">		<span class="co"># when TRUE run this</span></a>
<a class="sourceLine" id="cb288-5" title="5">		food &lt;-<span class="st"> &quot;fish&quot;</span></a>
<a class="sourceLine" id="cb288-6" title="6">	} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb288-7" title="7">		<span class="co"># when FALSE run this</span></a>
<a class="sourceLine" id="cb288-8" title="8">		food &lt;-<span class="st"> &quot;pizza&quot;</span></a>
<a class="sourceLine" id="cb288-9" title="9">	}</a>
<a class="sourceLine" id="cb288-10" title="10">      </a>
<a class="sourceLine" id="cb288-11" title="11">	<span class="co"># compose message</span></a>
<a class="sourceLine" id="cb288-12" title="12">	msg &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Give a&quot;</span>, animal, <span class="st">&quot;some&quot;</span>, food, <span class="st">&quot;for lunch.&quot;</span>)</a>
<a class="sourceLine" id="cb288-13" title="13">	<span class="kw">print</span>(msg)</a>
<a class="sourceLine" id="cb288-14" title="14">}</a></code></pre></div>
<pre><code>## [1] &quot;Give a human some pizza for lunch.&quot;
## [1] &quot;Give a cat some fish for lunch.&quot;
## [1] &quot;Give a turtle some pizza for lunch.&quot;
## [1] &quot;Give a zebra some pizza for lunch.&quot;</code></pre>
<p>Which generates a message for each animal.</p>
<p>The structure of an <code>if</code> statement is very similar to that of
a <code>for</code> loop. The code they execute (or do not execute) lies
between curly brackets. Whether or not an <code>if</code> statement executes
a particular block of code depends on the whether or not the
conditional statement is true or false.</p>
<p>If we wanted to also feed fish to turtles, and perhaps give something more
appropriate to zebras such as grass, then modify the above code so it
reads:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" title="1"><span class="cf">for</span> (animal <span class="cf">in</span> <span class="kw">c</span>(<span class="st">&quot;human&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;turtle&quot;</span>, <span class="st">&quot;zebra&quot;</span>)) {</a>
<a class="sourceLine" id="cb290-2" title="2">	<span class="co"># decide on food given to type of animal</span></a>
<a class="sourceLine" id="cb290-3" title="3">	<span class="cf">if</span> (animal <span class="op">==</span><span class="st"> &quot;cat&quot;</span> <span class="op">|</span><span class="st"> </span>animal <span class="op">==</span><span class="st"> &quot;turtle&quot;</span>) {</a>
<a class="sourceLine" id="cb290-4" title="4">		food &lt;-<span class="st"> &quot;fish&quot;</span></a>
<a class="sourceLine" id="cb290-5" title="5">	} <span class="cf">else</span> <span class="cf">if</span> (animal <span class="op">==</span><span class="st"> &quot;human&quot;</span>) {</a>
<a class="sourceLine" id="cb290-6" title="6">		food &lt;-<span class="st"> &quot;pizza&quot;</span></a>
<a class="sourceLine" id="cb290-7" title="7">	} <span class="cf">else</span> <span class="cf">if</span> (animal <span class="op">==</span><span class="st"> &quot;zebra&quot;</span>) {</a>
<a class="sourceLine" id="cb290-8" title="8">		food &lt;-<span class="st"> &quot;grass&quot;</span></a>
<a class="sourceLine" id="cb290-9" title="9">	} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb290-10" title="10">	food &lt;-<span class="st"> &quot;soup&quot;</span></a>
<a class="sourceLine" id="cb290-11" title="11">	}</a>
<a class="sourceLine" id="cb290-12" title="12">   </a>
<a class="sourceLine" id="cb290-13" title="13">	<span class="co"># compose message</span></a>
<a class="sourceLine" id="cb290-14" title="14">	msg &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;Give a&quot;</span>, animal, <span class="st">&quot;some&quot;</span>, food, <span class="st">&quot;for lunch.&quot;</span>)</a>
<a class="sourceLine" id="cb290-15" title="15">	<span class="kw">print</span>(msg)</a>
<a class="sourceLine" id="cb290-16" title="16">}</a></code></pre></div>
<pre><code>## [1] &quot;Give a human some pizza for lunch.&quot;
## [1] &quot;Give a cat some fish for lunch.&quot;
## [1] &quot;Give a turtle some fish for lunch.&quot;
## [1] &quot;Give a zebra some grass for lunch.&quot;</code></pre>
<p>See how the printed messages have changed.</p>
<p>An example in statistics when we would use an if statement is when we are creating a basic probability event simulator, such as rolling dice, or dealing cards. To simulate rolling a six-sided die we would write a function which would:</p>
<ol style="list-style-type: decimal">
<li>Draw a random number between 0 and 1. We use <code>runif()</code> for this.</li>
<li>Use if statements to workout the dice face based on the random number.</li>
<li>Return the dice roll result back to the user.</li>
</ol>
<p>In your script, type and run:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" title="1">roll_d6 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb292-2" title="2">	<span class="co"># draw random number between 0 and 1</span></a>
<a class="sourceLine" id="cb292-3" title="3">	p &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb292-4" title="4">	</a>
<a class="sourceLine" id="cb292-5" title="5">	<span class="co"># allocate dice face</span></a>
<a class="sourceLine" id="cb292-6" title="6">	<span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb292-7" title="7">		face &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb292-8" title="8">	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb292-9" title="9">		face &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb292-10" title="10">	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb292-11" title="11">		face &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb292-12" title="12">	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb292-13" title="13">		face &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb292-14" title="14">	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb292-15" title="15">		face &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb292-16" title="16">	} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb292-17" title="17">		face &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb292-18" title="18">	}</a>
<a class="sourceLine" id="cb292-19" title="19">	</a>
<a class="sourceLine" id="cb292-20" title="20">	<span class="kw">return</span>(face)</a>
<a class="sourceLine" id="cb292-21" title="21"> }</a>
<a class="sourceLine" id="cb292-22" title="22"></a>
<a class="sourceLine" id="cb292-23" title="23"><span class="kw">roll_d6</span>()</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>The function currently has no arguments, this is because everything about
rolling a single dice is fixed. A feature that we could add is to allow multiple dice
rolls with one call to <code>roll_d6()</code>, though we should assume by default
that the user just wants a single roll. Modify <code>roll_d6()</code> to allow
for this by looping over the existing code within the function <strong>n</strong> times and
storing the results:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" title="1">roll_d6 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n=</span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb294-2" title="2">	<span class="co"># empty vector of results</span></a>
<a class="sourceLine" id="cb294-3" title="3">	results &lt;-<span class="st"> </span><span class="kw">c</span>() </a>
<a class="sourceLine" id="cb294-4" title="4">	<span class="co"># allocate dice face for each probability      </span></a>
<a class="sourceLine" id="cb294-5" title="5">	<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</a>
<a class="sourceLine" id="cb294-6" title="6">    	p &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb294-7" title="7">    	</a>
<a class="sourceLine" id="cb294-8" title="8">    	<span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb294-9" title="9">    		face &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb294-10" title="10">    	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb294-11" title="11">    		face &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb294-12" title="12">    	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb294-13" title="13">    		face &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb294-14" title="14">    	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb294-15" title="15">    		face &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb294-16" title="16">    	} <span class="cf">else</span> <span class="cf">if</span> (p <span class="op">&lt;</span><span class="st"> </span><span class="dv">5</span><span class="op">/</span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb294-17" title="17">    		face &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb294-18" title="18">    	} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb294-19" title="19">    		face &lt;-<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb294-20" title="20">    	}</a>
<a class="sourceLine" id="cb294-21" title="21">    	</a>
<a class="sourceLine" id="cb294-22" title="22">    	<span class="co"># store result</span></a>
<a class="sourceLine" id="cb294-23" title="23">    	results[i] &lt;-<span class="st"> </span>face</a>
<a class="sourceLine" id="cb294-24" title="24">	}</a>
<a class="sourceLine" id="cb294-25" title="25">	<span class="kw">return</span>(results)</a>
<a class="sourceLine" id="cb294-26" title="26">}</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-155"></span>
<img src="week2/theme-dice-hist.png" alt="An example of simulating 20 dice rolls." width="\linewidth" />
<p class="caption">
Figure 2.2: An example of simulating 20 dice rolls.
</p>
</div>
<p>Play with this function; simulate a number of dice rolls and plot a graph of the results. Alter the number of dice rolls simulated, and see what it does to the graph. Note that the dice results are perfectly random, and any variation you see between the frequency of certain numbers is purely due to chance.</p>
<div id="summary-1" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Summary</h3>
<p>You can have execute a single line of code or block of code based on a certain logical comparison being true. This is done using an <code>if</code> statement which can take the following form:<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a></p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" title="1"><span class="cf">if</span> ( condition1 ) {</a>
<a class="sourceLine" id="cb295-2" title="2">	<span class="co"># code block 1</span></a>
<a class="sourceLine" id="cb295-3" title="3">} <span class="cf">else</span> <span class="cf">if</span> ( condition2 ) {</a>
<a class="sourceLine" id="cb295-4" title="4">	<span class="co"># code block 2</span></a>
<a class="sourceLine" id="cb295-5" title="5">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb295-6" title="6">	<span class="co"># code block 3</span></a>
<a class="sourceLine" id="cb295-7" title="7">}</a></code></pre></div>
</div>
</div>
<div id="probability-and-simulation" class="section level2">
<h2><span class="header-section-number">2.4</span> Probability and Simulation</h2>
<p>This section utilises the probability concepts you have been introduced to in other modules, and assumes that you are familiar with the concept of a random variable; mainly that it is a quantity or measure that is likely to vary if the process being observed was repeated. And that we can use probability distributions to describe variables.</p>
<p>Think about how you would answer the following questions if asked:</p>
<ul>
<li>What is a random event?</li>
<li>What is a random number?</li>
<li>What are some common probability distributions? And what types of data
or processes might be described by them?</li>
</ul>
<p>In this section we will cover several topics:</p>
<ul>
<li>Why we use simulation.</li>
<li>How to draw random samples from a set.</li>
<li>How to draw values from a probability distribution.</li>
<li>How simulation can show the law of large numbers (LLN) in action.</li>
</ul>
<p>Firstly, a random event is simply an event for which we do not know, <strong>for certain</strong>, what the outcome will be, though we may know the probability of each possible outcome. Examples are; flipping a coin, playing rock paper scissors, rolling dice, number of offspring, gender of the offspring.</p>
<p><img src="week2/RPS.png" width="0.5\linewidth" /><img src="week2/D12.png" width="0.5\linewidth" /></p>
<div id="random-sampling" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Random sampling</h3>
<p>Randomly sampling from a discrete set of values in R is easy! To do this we use the <code>sample()</code> function, which resamples values from a vector, with or without replacement. It has a number of different uses. In the list below <code>n</code> is an integer, <code>x</code> is a vector, <code>p</code> is a vector probabilities with the same length of <code>x</code>:</p>
<ul>
<li><code>sample(n)</code> creates a vector of integers from 1 to <code>n</code>, in a random order</li>
<li><code>sample(x)</code> randomly permute <code>x</code></li>
<li><code>sample(x, replace=TRUE)</code> a bootstrap sample</li>
<li><code>sample(x, n)</code> sample <code>n</code> times from <code>x</code> without replacement</li>
<li><code>sample(x, n, replace=TRUE)</code> sample <strong>n</strong> times from <code>x</code> with replacement</li>
<li><code>sample(x, n, replace=TRUE, prob=p)</code> same as above, but sample each element of <code>x</code> with probability <code>p</code></li>
</ul>
<p>The last three of these provides us with different ways of sampling from a finite discrete set of values.</p>
</div>
<div id="rock-paper-scissors" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Rock, Paper Scissors</h3>
<p>To begin implementing Rock, Paper, Scissors in R, we need to specify the finite set of choices. Then sample once from it for each player:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" title="1"><span class="co"># set of possible choices</span></a>
<a class="sourceLine" id="cb296-2" title="2">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Rock&quot;</span>, <span class="st">&quot;Paper&quot;</span>, <span class="st">&quot;Scissors&quot;</span>)</a>
<a class="sourceLine" id="cb296-3" title="3"></a>
<a class="sourceLine" id="cb296-4" title="4"><span class="co"># players, make your choice</span></a>
<a class="sourceLine" id="cb296-5" title="5">p1 &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb296-6" title="6">p2 &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb296-7" title="7"></a>
<a class="sourceLine" id="cb296-8" title="8">p1</a></code></pre></div>
<pre><code>## [1] &quot;Rock&quot;</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" title="1">p2</a></code></pre></div>
<pre><code>## [1] &quot;Scissors&quot;</code></pre>
<p>The values of <code>p1</code> and <code>p2</code> show who won.</p>
<p>If you want to do best of 3 do:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" title="1"><span class="co"># players, make your choice (three times)</span></a>
<a class="sourceLine" id="cb300-2" title="2">p1 &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb300-3" title="3">p2 &lt;-<span class="st"> </span><span class="kw">sample</span>(x, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb300-4" title="4"></a>
<a class="sourceLine" id="cb300-5" title="5"><span class="co"># best of 3</span></a>
<a class="sourceLine" id="cb300-6" title="6"><span class="kw">rbind</span>(p1, p2)</a></code></pre></div>
<pre><code>##    [,1]    [,2]       [,3]      
## p1 &quot;Paper&quot; &quot;Scissors&quot; &quot;Rock&quot;    
## p2 &quot;Paper&quot; &quot;Rock&quot;     &quot;Scissors&quot;</code></pre>
</div>
<div id="simulating-the-law-of-large-numbers" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Simulating the law of large numbers</h3>
<p>The law of large numbers is a theorem from mathematics which states the following; if a random process could be repeated many, many, many times, the long-run <em>proportion</em> (or fraction) of times that a particular outcome happens <em>stabilises</em>. This means that for a small number of repetitions, we can expect to see a large amount of variability regarding the proportion that <em>hit</em>. Whereas, for a large number of repetitions, the proportion of ``hits’’ would be more stable (less varied).</p>
<p>For example, when looking at science GCSE results from schools, we would expect to see that for the small schools (often in a quaint village), the proportion of the children obtaining a grade C or above would vary wildly from small school to small school. However, looking at the same proportion but for big city schools, we would expect to see less variation in the proportion from big school to big school. Let us put this in to action.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></p>
<p>Start a script or rmarkdown file, with a title-section including information that we are simulating the law of large numbers. With the particular application being that we are looking at how the variability in the proportion of children obtaining a science GCSE grade C or above within a school is dependent on the size of the school.</p>
<p>To start, we are going to use the <code>rbinom()</code> function to simulate one schools worth of GCSE results. This function is one of the standard functions that comes with R (no need for packages) and allows us to randomly draw from a binomial distribution.</p>
<p>Looking at the help page to understand the arguments of <code>rbinom()</code>, set the size of the trial to be <span class="math inline">\(30\)</span> (this is the size of one year group in our small, quaint school). Set the probability of success to <span class="math inline">\(0.59\)</span>, this is the probability of a grade C or above.</p>
<p>And set the number of observations to be one, as we’re only interested in looking at one small school right now.</p>
<p>When you send this command to the console, it should return a count. To express this as a proportion, update your command to divide by the size of the school.</p>
<p>Now, we are interested in the results of <span class="math inline">\(100\)</span> schools of this size, increase the number of observations accordingly. Create a data frame with one column containing these results, and a second column containing the size of the schools.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" title="1">n_obs &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb302-2" title="2">size  &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb302-3" title="3">pr    &lt;-<span class="st"> </span><span class="fl">0.59</span></a>
<a class="sourceLine" id="cb302-4" title="4"></a>
<a class="sourceLine" id="cb302-5" title="5">tiny_schools &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb302-6" title="6">	<span class="dt">sci_prop =</span> <span class="kw">rbinom</span>(n_obs, size, pr),</a>
<a class="sourceLine" id="cb302-7" title="7">	<span class="dt">size     =</span> size</a>
<a class="sourceLine" id="cb302-8" title="8">)</a></code></pre></div>
<p>Repeat the above process, but create a new data frame for each of the
following sized schools; small (size of <span class="math inline">\(100\)</span>), medium schools (size of <span class="math inline">\(200\)</span>),
large (size of <span class="math inline">\(500\)</span>), and mega schools (size of <span class="math inline">\(1000\)</span>). Combine the
rows of each of these data frames into one data frame by using <code>rbind()</code>
as follows:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" title="1">schools &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb303-2" title="2">	tiny_schools,</a>
<a class="sourceLine" id="cb303-3" title="3">	small_schools,</a>
<a class="sourceLine" id="cb303-4" title="4">	medium_schools,</a>
<a class="sourceLine" id="cb303-5" title="5">	large_schools,</a>
<a class="sourceLine" id="cb303-6" title="6">	mega_schools</a>
<a class="sourceLine" id="cb303-7" title="7">)</a></code></pre></div>
<div class="figure"><span id="fig:gcse"></span>
<img src="week2/theme-gcse.png" alt="Variation in proportion due to size of the year group. Demonstrating the law of large numbers." width="\linewidth" />
<p class="caption">
Figure 2.3: Variation in proportion due to size of the year group. Demonstrating the law of large numbers.
</p>
</div>
<p>Create a <code>ggplot</code> comparing school size to the proportion of those of who got grades C and above. Check if it looks similar to Figure <a href="loops-conditional-statements-and-simulation.html#fig:gcse">2.3</a>.</p>
<p>How do you interpret this plot? Well, for a start, we know from our code that all children across all schools had the same probability of getting a grade C or above, so no school is inherently doing anything different in preparing it’s children for the GCSE exams. In fact, the only thing we allowed to vary was the size of the school. So the variation we are seeing in regards to the proportion of students who obtained a grade C or above within each school is related to the size of the year group at that school. And we see that the big year groups, tend to be closer to the true proportion than the smaller groups. This is the law of large numbers.</p>
<p>If you did not know about the law of large numbers, and you were to simply look at the top 25 schools, then you would likely conclude that small schools are better than big schools, as the top ranks are dominated by the smaller-sized schools. We can see the top 25 schools with:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb304-1" title="1">schools &lt;-<span class="st"> </span><span class="kw">arrange</span>(schools, <span class="kw">desc</span>(sci_prop))</a>
<a class="sourceLine" id="cb304-2" title="2">schools[<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>, ]</a></code></pre></div>
<pre><code>##    sci_prop size
## 1       633 1000
## 2       631 1000
## 3       616 1000
## 4       614 1000
## 5       611 1000
## 6       611 1000
## 7       611 1000
## 8       611 1000
## 9       611 1000
## 10      609 1000
## 11      608 1000
## 12      606 1000
## 13      605 1000
## 14      604 1000
## 15      603 1000
## 16      603 1000
## 17      602 1000
## 18      602 1000
## 19      602 1000
## 20      602 1000
## 21      601 1000
## 22      600 1000
## 23      600 1000
## 24      599 1000
## 25      599 1000</code></pre>
</div>
<div id="probability-distributions" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Probability distributions</h3>
<p>R provides built-in functions that allow us to compute the density, cumulative probability, quantiles and random numbers from many standard probability distributions. Here we will look at the normal distribution and the binomial distribution, but other distributions follow exactly the same pattern. Table <a href="loops-conditional-statements-and-simulation.html#tab:rfunc">2.1</a> contains a list of random generator functions for some of the standard probability distributions. The first parameter of these functions is always <code>n</code> which is the number of random values that you want to generate.</p>
<table>
<caption><span id="tab:rfunc">Table 2.1: </span> Random generator functions for a selection of the standard probability distributions.</caption>
<thead>
<tr class="header">
<th align="right">Probability dist.</th>
<th align="right">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">Beta</td>
<td align="right"><code>rbeta(n, shape1, shape2)</code></td>
</tr>
<tr class="even">
<td align="right">Binomial</td>
<td align="right"><code>rbinom(n, size, prob)</code></td>
</tr>
<tr class="odd">
<td align="right">Chi-squared</td>
<td align="right"><code>rchisq(n, df)</code></td>
</tr>
<tr class="even">
<td align="right">Exponential</td>
<td align="right"><code>rexp(n, rate)</code></td>
</tr>
<tr class="odd">
<td align="right">Gamma</td>
<td align="right"><code>rgamma(n, shape, rate)</code></td>
</tr>
<tr class="even">
<td align="right">Normal</td>
<td align="right"><code>rnorm(n, mean, sd)</code></td>
</tr>
<tr class="odd">
<td align="right">Poisson</td>
<td align="right"><code>rpois(n, lambda)</code></td>
</tr>
<tr class="even">
<td align="right">Student-t</td>
<td align="right"><code>rt(n, df)</code></td>
</tr>
<tr class="odd">
<td align="right">Uniform</td>
<td align="right"><code>runif(n, min, max)</code></td>
</tr>
</tbody>
</table>
<p>To begin experimenting with these functions, look at the following two webpages:</p>
<p><a href="http://nemeth.shinyapps.io/rnorm" class="uri">http://nemeth.shinyapps.io/rnorm</a></p>
<p><a href="http://nemeth.shinyapps.io/rbinom" class="uri">http://nemeth.shinyapps.io/rbinom</a></p>
<p>On each of these pages you can adjust the parameters of the random functions and see the results instantly. Note these webpages are Shiny Apps which are simple to create in RStudio. We will meet these again later in the course.</p>
<p>To directly simulate random values in R:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" title="1">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n=</span><span class="dv">10</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb306-2" title="2"><span class="kw">print</span>(x)</a></code></pre></div>
<pre><code>##  [1] -0.009750928 -0.302842775  1.816186604  0.236721963  1.019409887
##  [6] -0.945510628  0.428613459  1.053228940  0.735166603 -1.091237885</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" title="1"><span class="kw">qplot</span>(x)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<p>If you rerun these two commands repeatedly you will notice that the <span class="math inline">\(10\)</span> values you draw each time changes.</p>
<p>You may have noticed that all of the random functions start with <code>r</code> and follow with an abbreviation of the distribution name. Replacing <code>r</code> with <code>d</code>, <code>p</code>, <code>q</code> will give you the names of the functions that allow you to calculate density values, cumulative probabilities, and quantiles, respectively.</p>
</div>
<div id="repeating-your-simulation" class="section level3">
<h3><span class="header-section-number">2.4.5</span> Repeating your simulation</h3>
<p>The numbers produced by <code>rnorm()</code>, <code>rbinom()</code>, and the other <code>r...</code> functions are actually <em>pseudo</em>-random numbers. They are random enough rather than genuinely random.</p>
<p>The state of the random generator is controlled by the object <code>.Random.seed</code> which contains a list of integers:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" title="1"><span class="co"># next 3 values to be used by the random generator</span></a>
<a class="sourceLine" id="cb310-2" title="2">.Random.seed[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1]      10403        518 -241867934</code></pre>
<p>Whenever <code>sample()</code> or an <code>r</code> function is run, the current state of <code>.Random.seed</code> is used.</p>
<p>In order to re-run a simulation, we need to control the starting point of <code>.Random.seed</code> this can be done via <code>set.seed()</code> like so:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" title="1"><span class="kw">set.seed</span>(<span class="dv">4578</span>)</a>
<a class="sourceLine" id="cb312-2" title="2"><span class="kw">rnorm</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] -0.3906706 -1.8656330 -0.2399937 -0.8530353</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" title="1"><span class="kw">rnorm</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] -1.1927956  0.3692942 -1.4857336 -0.3040490</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" title="1"><span class="kw">set.seed</span>(<span class="dv">4578</span>)</a>
<a class="sourceLine" id="cb316-2" title="2"><span class="kw">rnorm</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] -0.3906706 -1.8656330</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb318-1" title="1"><span class="kw">rnorm</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] -0.2399937 -0.8530353</code></pre>
<p>You would typically set your seed when you are performing simulations and wish to make your work reproducible. This allows others to rerun your code on their computers and obtain the same results. Without setting our seeds to be the same, even if we run the same code, the numbers we would generate would be different.</p>
</div>
<div id="densities" class="section level3">
<h3><span class="header-section-number">2.4.6</span> Densities</h3>
<p>The density function is probably the least used in practice out of the four function types. But if, for instance, you wanted to draw a probability distribution, such as the normal distribution then it could be quickly done like this:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb320-1" title="1">x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dt">by=</span><span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb320-2" title="2">dn &lt;-<span class="st"> </span><span class="kw">dnorm</span>(x)</a>
<a class="sourceLine" id="cb320-3" title="3"><span class="kw">qplot</span>(x, dn, <span class="dt">geom=</span><span class="st">&quot;line&quot;</span>)</a></code></pre></div>
<p><img src="week2/theme-dnorm.png" width="\linewidth" /></p>
<p>For discrete distributions, where variables can only take distinct values, it is more appropriate to draw a bar chart rather than a continuous line. Here is a binomial distribution with <span class="math inline">\(size=10\)</span> and <span class="math inline">\(p=0.33\)</span>:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" title="1">x=<span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb321-2" title="2">binom &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x,</a>
<a class="sourceLine" id="cb321-3" title="3">                    <span class="dt">db=</span><span class="kw">dbinom</span>(x, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.33</span>))</a>
<a class="sourceLine" id="cb321-4" title="4"><span class="kw">ggplot</span>(binom,<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(x), <span class="dt">y=</span>db)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
<p><img src="week2/theme-dbinom.png" width="\linewidth" /></p>
</div>
<div id="probabilities" class="section level3">
<h3><span class="header-section-number">2.4.7</span> Probabilities</h3>
<p>The <code>pnorm()</code> and <code>pbinom()</code> functions can be used to calculate probabilities. For example, to calculate the probability of observing <span class="math inline">\(X\)</span> being less than 2 when <span class="math inline">\(X\)</span> is said to follow a standard normal distribution:
<span class="math display">\[
\text{Pr}(X \leq 2) ~~~\text{where}~~~ X \sim \text{Normal}(0, 1),
\]</span>
we would use <code>pnorm()</code> such that</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" title="1"><span class="kw">pnorm</span>(<span class="dv">2</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 0.9772499</code></pre>
<p>Similarly, to calculate the probability of flipping a coin ten times and observing <em>at least</em> 3 heads:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" title="1"><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pbinom</span>(<span class="dv">2</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## [1] 0.9453125</code></pre>
<p>The <code>p</code> functions compute the probability for a given number or vector of numbers. These functions also goes by the ominous title of the “Cumulative Distribution Function”. This is because the word <em>cumulative</em> refers to the fact that we always calculate the probability of less than or equal to our number occurring.</p>
<p>When you carry out statistical tests such as a t-test or chi-sqaured test, once you have calculated your summary statistic, you can then use <code>pt()</code> or <code>pchisq()</code>, respectively, to calculate your <span class="math inline">\(p\)</span>-value. As performing these tests is a common practice in statistics we obviously have functions that will do all of this for us (namely <code>t.test()</code> and <code>chisq.test()</code>, but inside these functions they are using these <code>p...()</code> functions.</p>
<p>Also note that when calculating <span class="math inline">\(p\)</span>-values when you want the upper tail (which is most of the time) it is better practice to code:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" title="1"><span class="kw">pbinom</span>(<span class="dv">2</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.5</span>, <span class="dt">lower.tail=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 0.9453125</code></pre>
<p>This is because the <code>lower.tail</code> option is better at handling cases at the extremes of the distributions.</p>
</div>
<div id="quantiles" class="section level3">
<h3><span class="header-section-number">2.4.8</span> Quantiles</h3>
<p>The quantile functions are the opposite to the probability functions.
To use <code>qnorm()</code> we have to specify a probability, and it will return
the corresponding value of <span class="math inline">\(X\)</span>:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" title="1"><span class="kw">qnorm</span>(<span class="fl">0.975</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 1.959964</code></pre>
<p>To rewrite this mathematically:
<span class="math display">\[
\text{Pr}(X \leq 1.96) = 0.975 ~~~\text{where}~~~ X \sim \text{Normal}(0, 1).
\]</span></p>
<p>Similarly, if we let <span class="math inline">\(Z \sim \text{Normal}(1, 9)\)</span>. To find the value <span class="math inline">\(q\)</span> (quantile) such that Pr<span class="math inline">\((Z \leq q)\)</span> is <span class="math inline">\(0.05\)</span> type:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" title="1"><span class="kw">qnorm</span>(<span class="fl">0.05</span>, <span class="dt">mean=</span><span class="dv">1</span>, <span class="dt">sd=</span><span class="kw">sqrt</span>(<span class="dv">9</span>))</a></code></pre></div>
<pre><code>## [1] -3.934561</code></pre>
<p>These functions also take a vector of quantiles. For example to find Pr<span class="math inline">\((Z \leq -3.9)\)</span>, Pr<span class="math inline">\((Z \leq 0)\)</span>, and Pr<span class="math inline">\((Z \leq 7)\)</span> type:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" title="1">q &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">3.9</span>, <span class="dv">0</span>, <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb332-2" title="2"><span class="kw">pnorm</span>(q, <span class="dt">mean=</span><span class="dv">1</span>, <span class="dt">sd=</span><span class="kw">sqrt</span>(<span class="dv">9</span>))</a></code></pre></div>
<pre><code>## [1] 0.05119945 0.36944134 0.97724987</code></pre>
</div>
<div id="summary-2" class="section level3">
<h3><span class="header-section-number">2.4.9</span> Summary</h3>
<ul>
<li><p>Simulation is the process of using a computer to generate random numbers to create data. We can simulate data from discrete and continuous probability distributions.</p></li>
<li><p>R provides functions for generating random numbers from the common probability distributions. All functions return a vector of <code>n</code> realisations. Table <a href="loops-conditional-statements-and-simulation.html#tab:rfunc">2.1</a> contains a list of some these functions. Note that R does not necessarily use the same parameterisation for these probability distributions as you will see in your courses, or in popular stats text books. Therefore always check the help page of the function to confirm its particular parameterisation.</p></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" title="1"><span class="co"># simulate 10 unbiased-coin flips</span></a>
<a class="sourceLine" id="cb334-2" title="2"><span class="kw">rbinom</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>##  [1] 0 0 1 0 0 0 0 0 0 1</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" title="1"><span class="co"># simulate total number of heads for 2 trials</span></a>
<a class="sourceLine" id="cb336-2" title="2"><span class="co"># of 100 unbiased-coin flips</span></a>
<a class="sourceLine" id="cb336-3" title="3"><span class="kw">rbinom</span>(<span class="dv">2</span>, <span class="dv">100</span>, <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## [1] 46 46</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" title="1"><span class="co"># draw from 5 values from a standard normal distribution</span></a>
<a class="sourceLine" id="cb338-2" title="2"><span class="co"># Standard normal distribution N(0,1^2)</span></a>
<a class="sourceLine" id="cb338-3" title="3"><span class="co"># mean = 0 and standard deviation = 1</span></a>
<a class="sourceLine" id="cb338-4" title="4"><span class="kw">rnorm</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] -0.1047152  0.9304077  1.4534803 -0.9740542 -0.4645038</code></pre>
<ul>
<li><p>To ensure your simulations are reproducible use <code>set.seed()</code> to specify a starting point for the random number generator.</p></li>
<li><p>The first letter of all the functions in Table <a href="loops-conditional-statements-and-simulation.html#tab:rfunc">2.1</a> is <code>r</code> which stands for “random”. For each probability distribution there are also density (<code>d</code>), quantile (<code>q</code>), and cumulative probability functions (<code>p</code>).</p></li>
</ul>
<p>For example, say, <span class="math inline">\(X \sim \text{Normal}(6, 5)\)</span>, then to calculate the probability that we observe <span class="math inline">\(x\)</span> being less than or equal to <span class="math inline">\(3\)</span>, <span class="math inline">\(\text{Pr}(X \leq 3)\)</span>:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" title="1"><span class="kw">pnorm</span>(<span class="dv">3</span>, <span class="dt">mean=</span><span class="dv">6</span>, <span class="dt">sd=</span><span class="kw">sqrt</span>(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>## [1] 0.08985625</code></pre>
<p>Similarly, if we wanted to calculate what quantile, <span class="math inline">\(q\)</span>, of <span class="math inline">\(X\)</span> would correspond to the following:
<span class="math display">\[
\text{Pr}(X \leq q) = 0.975
\]</span>
then we would use the following command:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" title="1"><span class="kw">qnorm</span>(<span class="fl">0.975</span>, <span class="dt">mean=</span><span class="dv">6</span>, <span class="dt">sd=</span><span class="kw">sqrt</span>(<span class="dv">5</span>))</a></code></pre></div>
<pre><code>## [1] 10.38261</code></pre>
</div>
<div id="exercises" class="section level3">
<h3><span class="header-section-number">2.4.10</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Generate some random data and calculate quantile summary statistics:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>Set your seed to be <code>59810</code>.</li>
<li>Simulate 100 values from a random normal distribution with mean 25 and
standard deviation 8. Store these in a vector.</li>
<li>Use <code>quantile()</code> to calculate the 25% and 75% quantiles for your vectors.
d.Compare these against the 0.25 and 0.75 quantiles calculated using <code>qnorm()</code>.</li>
</ol>
<ul>
<li>Note that differences in quantile values are due to your vector containing randomly simulated values.</li>
<li>Quantiles from <code>qnorm()</code> should be 19.60408 and 30.39592.</li>
<li>Quantiles from your vector should be 19.206859 and 31.505227.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Play with random generator functions for other probability distributions:</li>
</ol>
<ul>
<li><a href="http://nemeth.shinyapps.io/rbeta" class="uri">http://nemeth.shinyapps.io/rbeta</a></li>
<li><a href="http://nemeth.shinyapps.io/rchisq" class="uri">http://nemeth.shinyapps.io/rchisq</a></li>
<li><a href="http://nemeth.shinyapps.io/rgamma" class="uri">http://nemeth.shinyapps.io/rgamma</a></li>
<li><a href="http://nemeth.shinyapps.io/rexp" class="uri">http://nemeth.shinyapps.io/rexp</a></li>
</ul>
</div>
</div>
<div id="combining-loops-and-simulation" class="section level2">
<h2><span class="header-section-number">2.5</span> Combining Loops and Simulation</h2>
<p>The population model discussed in the Loop section is considered to be a deterministic model as there is no random variation, it is simply a set of equations we evaluate at each time point. What we can do is give this model a random component. We do this by changing the way we think about individuals in the population. For example, instead of saying 0.24 of females produce an offspring, we know say each female has a probability of 0.24 of producing an offspring. So, the deterministic model looked like this:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" title="1"><span class="co"># time period</span></a>
<a class="sourceLine" id="cb344-2" title="2">years &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb344-3" title="3"></a>
<a class="sourceLine" id="cb344-4" title="4"><span class="co"># constants</span></a>
<a class="sourceLine" id="cb344-5" title="5">p0 &lt;-<span class="st"> </span><span class="fl">0.11</span></a>
<a class="sourceLine" id="cb344-6" title="6">p1 &lt;-<span class="st"> </span><span class="fl">0.71</span></a>
<a class="sourceLine" id="cb344-7" title="7">p2 &lt;-<span class="st"> </span><span class="fl">0.94</span></a>
<a class="sourceLine" id="cb344-8" title="8">f  &lt;-<span class="st"> </span><span class="fl">0.24</span></a>
<a class="sourceLine" id="cb344-9" title="9"></a>
<a class="sourceLine" id="cb344-10" title="10"><span class="co"># initial population sizes</span></a>
<a class="sourceLine" id="cb344-11" title="11">J &lt;-<span class="st"> </span><span class="dv">1200</span></a>
<a class="sourceLine" id="cb344-12" title="12">S &lt;-<span class="st">  </span><span class="dv">800</span></a>
<a class="sourceLine" id="cb344-13" title="13">A &lt;-<span class="st"> </span><span class="dv">2000</span></a>
<a class="sourceLine" id="cb344-14" title="14"><span class="co"># population growth model</span></a>
<a class="sourceLine" id="cb344-15" title="15"><span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(years<span class="dv">-1</span>)) {</a>
<a class="sourceLine" id="cb344-16" title="16">	S[t<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>p0<span class="op">*</span>J[t]</a>
<a class="sourceLine" id="cb344-17" title="17">	A[t<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>p1<span class="op">*</span>S[t] <span class="op">+</span><span class="st"> </span>p2<span class="op">*</span>A[t]</a>
<a class="sourceLine" id="cb344-18" title="18">	J[t<span class="op">+</span><span class="dv">1</span>] &lt;-<span class="st"> </span>f<span class="op">*</span>A[t]</a>
<a class="sourceLine" id="cb344-19" title="19">}</a>
<a class="sourceLine" id="cb344-20" title="20"></a>
<a class="sourceLine" id="cb344-21" title="21"><span class="co"># store the results</span></a>
<a class="sourceLine" id="cb344-22" title="22">owl_pop &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb344-23" title="23">	<span class="dt">time  =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>years, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb344-24" title="24">	<span class="dt">group =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;J&quot;</span>, <span class="st">&quot;S&quot;</span>, <span class="st">&quot;A&quot;</span>), <span class="dt">each=</span>years),</a>
<a class="sourceLine" id="cb344-25" title="25">	<span class="dt">size  =</span> <span class="kw">c</span>(J, S, A)</a>
<a class="sourceLine" id="cb344-26" title="26">)</a>
<a class="sourceLine" id="cb344-27" title="27"></a>
<a class="sourceLine" id="cb344-28" title="28"><span class="co"># plot the results</span></a>
<a class="sourceLine" id="cb344-29" title="29"><span class="kw">ggplot</span>(owl_pop) <span class="op">+</span></a>
<a class="sourceLine" id="cb344-30" title="30">	<span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>size, <span class="dt">colour=</span>group, <span class="dt">linetype=</span>group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb344-31" title="31">	<span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;top&quot;</span>)</a></code></pre></div>
<p>Essentially, we want to replace the determinisitc equations in the for loop with calls to <code>rbinom()</code>. For example, for the subadult population, at each iteration we want to simulate one binomial sample with a size of <code>J[t]</code> with probability of success equal to <code>p0</code>.</p>
<p>Make these changes, and rerun the whole script. If you repeatedly rerun the script you will generate slight variations on the plot, this is due to the random component. Finally, set your seed to <code>87856</code>, rerun your script, and check if the plot you produce matches Figure <a href="loops-conditional-statements-and-simulation.html#fig:rnd-owl">2.4</a>.</p>
<div class="figure"><span id="fig:rnd-owl"></span>
<img src="week2/theme-rnd-owl.png" alt="Stochastic population growth model over the next 20 years for the Northern spotted owls. Random seed was set to 87856." width="\linewidth" />
<p class="caption">
Figure 2.4: Stochastic population growth model over the next 20 years for the Northern spotted owls. Random seed was set to 87856.
</p>
</div>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="10">
<li id="fn10"><p>The condition statements in <code>if</code> brackets are logical comparisons
that return a single <code>TRUE</code> or <code>FALSE</code>. The <code>else if</code> and <code>else</code> portions are optional, and will only be considered if previous conditional statements have all returned <code>FALSE</code>.<a href="loops-conditional-statements-and-simulation.html#fnref10" class="footnote-back">↩</a></p></li>
<li id="fn11"><p>Without knowing anything about each child, we assume that they all have the same probability of obtaining a grade C or above. In reality, even knowing a child’s gender means that we can start to adjust this probability. With females being more likely to obtain a grade C or above than males. <a href="http://gu.com/p/4vqfv" class="uri">http://gu.com/p/4vqfv</a>.<a href="loops-conditional-statements-and-simulation.html#fnref11" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-manipulation-and-plotting-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-manipulation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
